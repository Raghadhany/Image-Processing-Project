
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>gui</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2025-05-14"><meta name="DC.source" content="gui.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput"><span class="keyword">function</span> varargout = gui(varargin)
<span class="comment">% Begin initialization code - DO NOT EDIT</span>
gui_Singleton = 1;
gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
                   <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
                   <span class="string">'gui_OpeningFcn'</span>, @gui_OpeningFcn, <span class="keyword">...</span>
                   <span class="string">'gui_OutputFcn'</span>,  @gui_OutputFcn, <span class="keyword">...</span>
                   <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
                   <span class="string">'gui_Callback'</span>,   []);
<span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
<span class="keyword">end</span>

<span class="keyword">if</span> nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
<span class="keyword">else</span>
    gui_mainfcn(gui_State, varargin{:});
<span class="keyword">end</span>
<span class="comment">% End initialization code - DO NOT EDIT</span>


<span class="comment">% --- Executes just before gui is made visible.</span>
<span class="keyword">function</span> gui_OpeningFcn(hObject, ~, handles, varargin)
<span class="comment">% Initialize filter options</span>
set(handles.popupmenu1, <span class="string">'String'</span>, {<span class="string">'Correlation'</span>, <span class="string">'Weighted'</span>});
set(handles.popupmenu1, <span class="string">'Value'</span>, 1);
set(handles.edit1, <span class="string">'String'</span>, <span class="string">'0'</span>);
set(handles.edit2, <span class="string">'String'</span>, <span class="string">'255'</span>);

<span class="comment">% Initialize default kernel</span>
handles.filterKernel = ones(3,3)/9;
<span class="keyword">if</span> isfield(handles, <span class="string">'uitable3'</span>)
    set(handles.uitable3, <span class="string">'Data'</span>, num2cell(handles.filterKernel));
<span class="keyword">end</span>

<span class="comment">% Initialize non-linear filter options</span>
nonLinearFilters = {
    <span class="string">'Min Filter'</span>,
    <span class="string">'Max Filter'</span>,
    <span class="string">'Mean Filter'</span>,
    <span class="string">'Midpoint Filter'</span>,
    <span class="string">'Median Filter'</span>
    };
set(handles.popupmenu3, <span class="string">'String'</span>, nonLinearFilters);
set(handles.popupmenu3, <span class="string">'Value'</span>, 1); <span class="comment">% Default to first option</span>

noiseFilters = {
    <span class="string">'Min Filter'</span>,
    <span class="string">'Max Filter'</span>,
    <span class="string">'Mean Filter'</span>,
    <span class="string">'Median Filter'</span>,
    <span class="string">'Midpoint Filter'</span>
};

set(handles.popupmenu6, <span class="string">'String'</span>, noiseFilters); <span class="comment">% Assuming popupmenu3 is for noise filters</span>
set(handles.popupmenu6, <span class="string">'Value'</span>, 1); <span class="comment">% Default to first option</span>

set(handles.edit7, <span class="string">'String'</span>, <span class="string">'0.05'</span>);  <span class="comment">% Salt &amp; Pepper PS</span>
set(handles.edit8, <span class="string">'String'</span>, <span class="string">'0.05'</span>);  <span class="comment">% Salt &amp; Pepper PP</span>
set(handles.edit9, <span class="string">'String'</span>, <span class="string">'10'</span>);    <span class="comment">% Uniform a</span>
set(handles.edit10, <span class="string">'String'</span>, <span class="string">'200'</span>);  <span class="comment">% Uniform b</span>
set(handles.edit11, <span class="string">'String'</span>, <span class="string">'10'</span>);   <span class="comment">% Uniform P</span>
set(handles.edit12, <span class="string">'String'</span>, <span class="string">'10'</span>);   <span class="comment">% Gaussian seg</span>
set(handles.edit13, <span class="string">'String'</span>, <span class="string">'10'</span>);   <span class="comment">% Gaussian m</span>
set(handles.edit14, <span class="string">'String'</span>, <span class="string">'10'</span>);   <span class="comment">% Gaussian P</span>
set(handles.edit17, <span class="string">'String'</span>, <span class="string">'10'</span>);   <span class="comment">% Exponential a</span>
set(handles.edit18, <span class="string">'String'</span>, <span class="string">'200'</span>);  <span class="comment">% Exponential b</span>
set(handles.edit19, <span class="string">'String'</span>, <span class="string">'240'</span>);  <span class="comment">% Rayleigh b</span>
set(handles.edit20, <span class="string">'String'</span>, <span class="string">'240'</span>);  <span class="comment">% Rayleigh a</span>
set(handles.edit21, <span class="string">'String'</span>, <span class="string">'0'</span>);    <span class="comment">% Gamma a</span>
set(handles.edit22, <span class="string">'String'</span>, <span class="string">'255'</span>);  <span class="comment">% Gamma b</span>
<span class="comment">% Initialize image fields</span>
handles.currentImage = [];
handles.filteredImage = [];
<span class="comment">% Initialize point operations menu</span>
pointOperations = {<span class="string">'Point Detection'</span>, <span class="string">'Point Sharpening'</span>};
set(handles.popupmenu7, <span class="string">'String'</span>, pointOperations);
set(handles.popupmenu7, <span class="string">'Value'</span>, 1); <span class="comment">% Default to Point Detection</span>
<span class="comment">% Initialize line operations menu</span>
lineOperations = {
    <span class="string">'Line Detection (Sobel)'</span>,
    <span class="string">'Line Detection (Roberts)'</span>,
    <span class="string">'Line Sharpening'</span>
};
set(handles.popupmenu8, <span class="string">'String'</span>, lineOperations);
set(handles.popupmenu8, <span class="string">'Value'</span>, 1); <span class="comment">% Default to Sobel</span>

<span class="comment">% Initialize direction buttons as invisible</span>
set([handles.pushbutton31, handles.pushbutton32, handles.pushbutton33, handles.pushbutton34], <span class="string">'Visible'</span>, <span class="string">'on'</span>,<span class="string">'Enable'</span>, <span class="string">'on'</span>);
set(handles.pushbutton31, <span class="string">'String'</span>, <span class="string">'H'</span>);
set(handles.pushbutton32, <span class="string">'String'</span>, <span class="string">'V'</span>);
set(handles.pushbutton33, <span class="string">'String'</span>, <span class="string">'DL'</span>);
set(handles.pushbutton34, <span class="string">'String'</span>, <span class="string">'DR'</span>);
<span class="comment">% Initialize transformation parameters</span>
handles.transformationParams = struct(<span class="keyword">...</span>
    <span class="string">'gammaValue'</span>, 1.0, <span class="keyword">...</span><span class="comment">      % Default gamma value</span>
    <span class="string">'logConstant'</span>, 1.0, <span class="keyword">...</span><span class="comment">     % Constant for log transformation</span>
    <span class="string">'negativeActive'</span>, false <span class="keyword">...</span><span class="comment">  % Flag for negative transformation</span>
);

<span class="comment">% Set default gamma value in the edit box</span>
set(handles.edit23, <span class="string">'String'</span>, num2str(handles.transformationParams.gammaValue));
<span class="comment">% Initialize frequency domain filter parameters</span>
set(handles.edit26, <span class="string">'String'</span>, <span class="string">'5'</span>);  <span class="comment">% D0 cutoff frequency</span>
set(handles.edit27, <span class="string">'String'</span>, <span class="string">'1'</span>);  <span class="comment">% Butterworth order</span>

<span class="comment">% Initialize filter type popupmenu</span>
filterTypes = {
    <span class="string">'Ideal Low Pass'</span>,
    <span class="string">'Ideal High Pass'</span>,
    <span class="string">'Butterworth Low Pass'</span>,
    <span class="string">'Butterworth High Pass'</span>,
    <span class="string">'Gaussian Low Pass'</span>,
    <span class="string">'Gaussian High Pass'</span>
};
set(handles.popupmenu10, <span class="string">'String'</span>, filterTypes);
set(handles.popupmenu10, <span class="string">'Value'</span>, 1); <span class="comment">% Default to Ideal Low Pass</span>
<span class="comment">% Initialize brightness parameters</span>
set(handles.edit28, <span class="string">'String'</span>, <span class="string">'10'</span>);  <span class="comment">% Default brightness adjustment value</span>
handles.brightnessValue = 10;
<span class="comment">% Choose default command line output</span>
handles.output = hObject;
handles.currentImage = [];
handles.noisyImage = [];
handles.frequencyFilteredImage = [];
<span class="comment">% Initialize Fourier transform variables</span>
handles.fourierData = [];       <span class="comment">% Will store Fourier transform data</span>
handles.reconstructedImage = []; <span class="comment">% Will store reconstructed image</span>
<span class="comment">% Initialize conversion parameters</span>
set(handles.edit29, <span class="string">'String'</span>, <span class="string">'127'</span>);  <span class="comment">% Default binary threshold</span>
set(handles.edit30, <span class="string">'String'</span>, <span class="string">'1'</span>);    <span class="comment">% Default grayscale method (1-5)</span>
<span class="comment">% Initialize other variables</span>
handles.currentImage = [];
handles.processedImage = [];
<span class="comment">% Initialize default values for Fourier display</span>
handles.fourierDisplayMode = <span class="string">'magnitude'</span>; <span class="comment">% Can be 'magnitude' or 'phase'</span>
<span class="comment">% Initialize kernel size (default 3x3)</span>
handles.kernelSize = 3;

<span class="comment">% Update handles structure</span>
guidata(hObject, handles);

<span class="comment">% UIWAIT makes gui wait for user response (see UIRESUME)</span>
<span class="comment">% uiwait(handles.figure1);</span>


<span class="comment">% --- Outputs from this function are returned to the command line.</span>
<span class="keyword">function</span> varargout = gui_OutputFcn(hObject, eventdata, handles)
<span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
<span class="comment">% hObject    handle to figure</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Get default command line output from handles structure</span>
varargout{1} = handles.output;

<span class="comment">% --- Helper function to validate numeric input</span>
<span class="keyword">function</span> valid = validateInput(handle, minVal, maxVal, isInteger)
str = get(handle, <span class="string">'String'</span>);
num = str2double(str);
<span class="keyword">if</span> isnan(num) || num &lt; minVal || num &gt; maxVal
    valid = false;
    set(handle, <span class="string">'String'</span>, <span class="string">''</span>);
    errordlg(sprintf(<span class="string">'Please enter a number between %.2f and %.2f'</span>, minVal, maxVal), <span class="string">'Invalid Input'</span>);
<span class="keyword">else</span>
    <span class="keyword">if</span> isInteger
        num = round(num);
        set(handle, <span class="string">'String'</span>, num2str(num));
    <span class="keyword">end</span>
    valid = true;
<span class="keyword">end</span>
<span class="comment">% --- Executes on selection change in popupmenu1.</span>
<span class="keyword">function</span> popupmenu1_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
set(handles.uitable3, <span class="string">'Data'</span>, handles.filterKernel);

<span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu1 contents as cell array</span>
<span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu1</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> popupmenu1_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on selection change in listbox1.</span>
<span class="keyword">function</span> listbox1_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to listbox1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns listbox1 contents as cell array</span>
<span class="comment">%        contents{get(hObject,'Value')} returns selected item from listbox1</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> listbox1_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to listbox1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: listbox controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in apply.</span>
<span class="keyword">function</span> apply_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first using the "Load Image" button.'</span>, <span class="string">'No Image Found'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Initialize default kernel if not exists</span>
    <span class="keyword">if</span> ~isfield(handles, <span class="string">'filterKernel'</span>)
        handles.filterKernel = ones(3,3)/9;
    <span class="keyword">end</span>

    <span class="comment">% Get selected filter type</span>
    filterTypes = get(handles.popupmenu1, <span class="string">'String'</span>);
    selectedFilter = filterTypes{get(handles.popupmenu1, <span class="string">'Value'</span>)};

    <span class="comment">% Get kernel data safely</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'uitable3'</span>)
        kernelData = get(handles.uitable3, <span class="string">'Data'</span>);
        <span class="keyword">if</span> iscell(kernelData)
            <span class="comment">% Convert cell to matrix, handling empty/non-numeric values</span>
            kernelData = cellfun(@(x) ifelse(isempty(x)||~isnumeric(x),0,x), kernelData, <span class="string">'UniformOutput'</span>, false);
            handles.filterKernel = cell2mat(kernelData);
        <span class="keyword">else</span>
            handles.filterKernel = kernelData;
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Process image</span>
    <span class="keyword">if</span> size(img, 3) == 3
        img = rgb2gray(img);
    <span class="keyword">end</span>

    <span class="comment">% Apply selected filter</span>
    <span class="keyword">switch</span> selectedFilter
        <span class="keyword">case</span> <span class="string">'Correlation'</span>
            filteredImg = imfilter(double(img), handles.filterKernel, <span class="string">'corr'</span>, <span class="string">'same'</span>);
        <span class="keyword">case</span> <span class="string">'Weighted'</span>
            <span class="comment">% Normalize kernel</span>
            normalizedKernel = handles.filterKernel / sum(handles.filterKernel(:));
            filteredImg = imfilter(double(img), normalizedKernel, <span class="string">'conv'</span>, <span class="string">'same'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Show filtered result in axes2</span>
    axes(handles.axes2);
    imshow(filteredImg, []);
    title([selectedFilter <span class="string">' Result'</span>]);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = filteredImg;
    guidata(hObject, handles);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error applying filter: '</span> e.message], <span class="string">'Filter Error'</span>);
<span class="keyword">end</span>

<span class="comment">% Helper function</span>
<span class="keyword">function</span> y = ifelse(condition, trueval, falseval)
<span class="keyword">if</span> condition
    y = trueval;
<span class="keyword">else</span>
    y = falseval;
<span class="keyword">end</span>

<span class="comment">% --------------------------------------------------------------------</span>
<span class="keyword">function</span> uitable3_ButtonDownFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to uitable3 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --- Executes when entered data in editable cell(s) in uitable3.</span>
<span class="keyword">function</span> uitable3_CellEditCallback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to uitable3 (see GCBO)</span>
<span class="comment">% eventdata  structure with the following fields (see MATLAB.UI.CONTROL.TABLE)</span>
<span class="comment">%	Indices: row and column indices of the cell(s) edited</span>
<span class="comment">%	PreviousData: previous data for the cell(s) edited</span>
<span class="comment">%	EditData: string(s) entered by the user</span>
<span class="comment">%	NewData: EditData or its converted form set on the Data property. Empty if Data was not changed</span>
<span class="comment">%	Error: error string when failed to convert EditData to appropriate value for Data</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
<span class="comment">% Update the kernel when table values are edited</span>
<span class="keyword">try</span>
    newData = get(hObject, <span class="string">'Data'</span>);
    <span class="comment">% Convert from cell if needed</span>
    <span class="keyword">if</span> iscell(newData)
        newData = cell2mat(newData);
    <span class="keyword">end</span>
    handles.filterKernel = newData;
    guidata(hObject, handles);
<span class="keyword">catch</span> e
    errordlg([<span class="string">'Invalid kernel value: '</span> e.message], <span class="string">'Input Error'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes during object deletion, before destroying properties.</span>
<span class="keyword">function</span> uitable4_DeleteFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to uitable4 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> uitable4_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to uitable4 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>


<span class="comment">% --- Executes during object deletion, before destroying properties.</span>
<span class="keyword">function</span> uipanel1_DeleteFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to uipanel1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --- Executes on selection change in popupmenu3.</span>
<span class="keyword">function</span> popupmenu3_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu3 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu3 contents as cell array</span>
<span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu3</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> popupmenu3_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu3 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton3.</span>
<span class="keyword">function</span> pushbutton3_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to pushbutton3 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --- Executes on button press in pushbutton2.</span>
<span class="keyword">function</span> pushbutton2_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to pushbutton2 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
<span class="comment">% Reset to default 3x3 averaging kernel</span>
handles.filterKernel = ones(3,3)/9;
set(handles.uitable3, <span class="string">'Data'</span>, handles.filterKernel);
guidata(hObject, handles);
msgbox(<span class="string">'Kernel reset to default 3x3 averaging filter.'</span>, <span class="string">'Reset Complete'</span>);


<span class="comment">% --- Executes on button press in pushbutton18 (Salt &amp; Pepper Noise).</span>
<span class="keyword">function</span> pushbutton18_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        <span class="comment">% Get salt &amp; pepper probabilities</span>
        ps = str2double(get(handles.edit7, <span class="string">'String'</span>));
        pp = str2double(get(handles.edit8, <span class="string">'String'</span>));

        <span class="comment">% Validate inputs</span>
        <span class="keyword">if</span> isnan(ps) || isnan(pp) || ps &lt; 0 || pp &lt; 0 || (ps+pp) &gt; 1
            errordlg(<span class="string">'Please enter valid probabilities (0 &lt;= PS,PP &lt;= 1, PS+PP &lt;= 1)'</span>, <span class="string">'Invalid Input'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Check if image exists</span>
        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Use filtered image if it exists, otherwise use original</span>
        <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        <span class="comment">% Add salt &amp; pepper noise</span>
        noisy_img = imnoise(img, <span class="string">'salt &amp; pepper'</span>, ps+pp);

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show noisy result in axes2</span>
        axes(handles.axes2);
        imshow(noisy_img);
        title([<span class="string">'Salt &amp; Pepper Noise (PS='</span> num2str(ps) <span class="string">', PP='</span> num2str(pp) <span class="string">')'</span>]);

        <span class="comment">% Store for next operation</span>
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error adding salt &amp; pepper noise: '</span> ME.message], <span class="string">'Processing Error'</span>);
    <span class="keyword">end</span>
<span class="comment">% --- Executes on selection change in popupmenu6.</span>
<span class="keyword">function</span> popupmenu6_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu6 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu6 contents as cell array</span>
<span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu6</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> popupmenu6_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu6 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton15.</span>
<span class="keyword">function</span> pushbutton15_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to pushbutton15 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>


<span class="comment">% --- Executes on button press in pushbutton8.</span>
<span class="keyword">function</span> pushbutton8_Callback(hObject, eventdata, handles)
<span class="comment">% Check if images exist</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first.'</span>, <span class="string">'No Image Found'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">if</span> ~isfield(handles, <span class="string">'filteredImage'</span>) || isempty(handles.filteredImage)
    errordlg(<span class="string">'No processed image available. Please apply a filter first.'</span>, <span class="string">'No Processed Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    originalImg = handles.currentImage;
    filteredImg = handles.filteredImage;

    <span class="comment">% Create figure for histogram comparison</span>
    hFig = figure(<span class="string">'Name'</span>, <span class="string">'Histogram Comparison'</span>, <span class="string">'NumberTitle'</span>, <span class="string">'off'</span>, <span class="string">'Position'</span>, [100 100 1000 800]);

    <span class="comment">% Original image</span>
    subplot(2,2,1);
    <span class="keyword">if</span> size(originalImg, 3) == 3
        imshow(originalImg);
        title(<span class="string">'Original Color Image'</span>);

        <span class="comment">% RGB histograms</span>
        subplot(2,2,3);
        imhist(originalImg(:,:,1));
        hold <span class="string">on</span>;
        imhist(originalImg(:,:,2));
        imhist(originalImg(:,:,3));
        hold <span class="string">off</span>;
        title(<span class="string">'Original RGB Histograms'</span>);
        legend(<span class="string">'Red'</span>,<span class="string">'Green'</span>,<span class="string">'Blue'</span>);
    <span class="keyword">else</span>
        imshow(originalImg);
        title(<span class="string">'Original Grayscale Image'</span>);

        subplot(2,2,3);
        imhist(originalImg);
        title(<span class="string">'Original Histogram'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Processed image</span>
    subplot(2,2,2);
    imshow(filteredImg);
    title(<span class="string">'Processed Image'</span>);

    subplot(2,2,4);
    <span class="keyword">if</span> size(filteredImg, 3) == 3
        imhist(filteredImg(:,:,1));
        hold <span class="string">on</span>;
        imhist(filteredImg(:,:,2));
        imhist(filteredImg(:,:,3));
        hold <span class="string">off</span>;
        title(<span class="string">'Processed RGB Histograms'</span>);
        legend(<span class="string">'Red'</span>,<span class="string">'Green'</span>,<span class="string">'Blue'</span>);
    <span class="keyword">else</span>
        imhist(filteredImg);
        title(<span class="string">'Processed Histogram'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Add main title</span>
    annotation(hFig, <span class="string">'textbox'</span>, [0.3 0.95 0.4 0.05], <span class="string">'String'</span>, <span class="keyword">...</span>
        <span class="string">'Histogram Comparison: Original vs Processed Image'</span>, <span class="keyword">...</span>
        <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error displaying histograms: '</span> e.message], <span class="string">'Display Error'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in pushbutton10.</span>
<span class="comment">% --- Executes on button press in pushbutton10.</span>
<span class="keyword">function</span> pushbutton10_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first.'</span>, <span class="string">'No Image Found'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

img = handles.currentImage;

<span class="keyword">try</span>
    <span class="comment">% Convert to grayscale if RGB</span>
    <span class="keyword">if</span> size(img, 3) == 3
        img = rgb2gray(img);
    <span class="keyword">end</span>

    <span class="comment">% Apply histogram equalization</span>
    equalizedImg = histeq(img);

    <span class="comment">% Display results</span>
    axes(handles.axes2); <span class="comment">% Assuming axes2 is for processed images</span>
    imshow(equalizedImg);
    title(<span class="string">'Histogram Equalization Result'</span>);

    <span class="comment">% Show histograms comparison</span>
    figure;
    subplot(2,1,1); imhist(img); title(<span class="string">'Original Histogram'</span>);
    subplot(2,1,2); imhist(equalizedImg); title(<span class="string">'Equalized Histogram'</span>);

    <span class="comment">% Store the processed image</span>
    handles.filteredImage = equalizedImg;
    guidata(hObject, handles);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error in histogram equalization: '</span> e.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit1_Callback(hObject, eventdata, handles)
<span class="comment">% Validate new min value</span>
val = str2double(get(hObject, <span class="string">'String'</span>));
<span class="keyword">if</span> isnan(val) || val &lt; 0 || val &gt; 255
    set(hObject, <span class="string">'String'</span>, <span class="string">'0'</span>);
    errordlg(<span class="string">'Please enter a value between 0 and 255'</span>, <span class="string">'Invalid Input'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit1_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to edit1 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit2_Callback(hObject, eventdata, handles)
<span class="comment">% Validate new max value</span>
val = str2double(get(hObject, <span class="string">'String'</span>));
<span class="keyword">if</span> isnan(val) || val &lt; 0 || val &gt; 255
    set(hObject, <span class="string">'String'</span>, <span class="string">'255'</span>);
    errordlg(<span class="string">'Please enter a value between 0 and 255'</span>, <span class="string">'Invalid Input'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit2_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to edit2 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton11.</span>
<span class="keyword">function</span> pushbutton11_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first.'</span>, <span class="string">'No Image Found'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">% Get min and max values from edit boxes</span>
<span class="keyword">try</span>
    newMin = str2double(get(handles.edit1, <span class="string">'String'</span>));
    newMax = str2double(get(handles.edit2, <span class="string">'String'</span>));

    <span class="keyword">if</span> isnan(newMin) || isnan(newMax) || newMin &gt;= newMax
        errordlg(<span class="string">'Please enter valid min/max values (min &lt; max).'</span>, <span class="string">'Invalid Input'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    img = handles.currentImage;

    <span class="comment">% Convert to grayscale if RGB</span>
    <span class="keyword">if</span> size(img, 3) == 3
        img = rgb2gray(img);
    <span class="keyword">end</span>

    <span class="comment">% Perform contrast stretching</span>
    minVal = double(min(img(:)));
    maxVal = double(max(img(:)));

    stretchedImg = (double(img) - minVal) .* ((newMax - newMin)/(maxVal - minVal)) + newMin;
    stretchedImg = uint8(stretchedImg);

    <span class="comment">% Display results</span>
    axes(handles.axes2);
    imshow(stretchedImg);
    title([<span class="string">'Contrast Stretching ['</span> num2str(newMin) <span class="string">' to '</span> num2str(newMax) <span class="string">']'</span>]);

    <span class="comment">% Store the processed image</span>
    handles.filteredImage = stretchedImg;
    guidata(hObject, handles);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error in contrast stretching: '</span> e.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>



<span class="comment">% --- Edit box callbacks (validation)</span>
<span class="keyword">function</span> edit7_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 1, false); <span class="comment">% Salt &amp; Pepper PS (0-1)</span>
<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit7_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit8_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 1, false); <span class="comment">% Salt &amp; Pepper PP (0-1)</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit8_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton19 (Uniform Noise).</span>
<span class="keyword">function</span> pushbutton19_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        <span class="comment">% Get parameters</span>
        a = str2double(get(handles.edit9, <span class="string">'String'</span>));
        b = str2double(get(handles.edit10, <span class="string">'String'</span>));
        P = str2double(get(handles.edit11, <span class="string">'String'</span>))/100;

        <span class="comment">% Validate</span>
        <span class="keyword">if</span> isnan(a) || isnan(b) || isnan(P) || b &lt;= a || P &lt;= 0 || P &gt; 1
            errordlg(<span class="string">'Invalid parameters (a &lt; b, 0 &lt; P &lt;= 100)'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Check image</span>
        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Load image first!'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Use filtered image if it exists, otherwise use original</span>
        <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        [rows, cols, ch] = size(img);

        <span class="comment">% Generate and scale noise properly</span>
        noise = a + (b-a)*rand(rows, cols, ch);
        noisy_img = double(img) + P*noise;

        <span class="comment">% Ensure proper range</span>
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show noisy result in axes2</span>
        axes(handles.axes2);
        imshow(noisy_img);
        title(<span class="string">'Uniform Noise Added'</span>);

        <span class="comment">% Store for next operation</span>
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Error'</span>);
    <span class="keyword">end</span>
<span class="keyword">function</span> edit9_Callback(hObject, eventdata, handles)
validateInput(hObject, -255, 255, true); <span class="comment">% Uniform a</span>

<span class="keyword">function</span> edit9_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit10_Callback(hObject, eventdata, handles)
validateInput(hObject, -255, 255, true); <span class="comment">% Uniform b</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit10_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="keyword">function</span> edit11_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); <span class="comment">% Uniform P (0-100%)</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit11_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="comment">% --- Executes on button press in pushbutton20 (Gaussian Noise).</span>
<span class="keyword">function</span> pushbutton20_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        seg = str2double(get(handles.edit12, <span class="string">'String'</span>));
        m = str2double(get(handles.edit13, <span class="string">'String'</span>));
        P = str2double(get(handles.edit14, <span class="string">'String'</span>))/100;

        <span class="keyword">if</span> isnan(seg) || isnan(m) || isnan(P) || seg &lt;= 0 || P &lt;= 0 || P &gt; 1
            errordlg(<span class="string">'Invalid parameters (seg &gt; 0, 0 &lt; P &lt;= 100)'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Load image first!'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Use filtered image if it exists, otherwise use original</span>
        <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        [rows, cols, ch] = size(img);

        <span class="comment">% Generate Gaussian noise</span>
        noise = m + seg*randn(rows, cols, ch);
        noisy_img = double(img) + P*noise;

        <span class="comment">% Clip and convert</span>
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show noisy result in axes2</span>
        axes(handles.axes2);
        imshow(noisy_img);
        title(<span class="string">'Gaussian Noise Added'</span>);

        <span class="comment">% Store for next operation</span>
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Error'</span>);
    <span class="keyword">end</span>

<span class="keyword">function</span> edit12_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); <span class="comment">% Gaussian seg</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit12_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit13_Callback(hObject, eventdata, handles)
validateInput(hObject, -255, 255, true); <span class="comment">% Gaussian m</span>

<span class="keyword">function</span> edit13_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit14_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); <span class="comment">% Gaussian P (0-100%)</span>
<span class="keyword">function</span> edit14_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton21 (Rayleigh Noise).</span>
<span class="keyword">function</span> pushbutton21_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        a = str2double(get(handles.edit20, <span class="string">'String'</span>));
        b = str2double(get(handles.edit19, <span class="string">'String'</span>));

        <span class="keyword">if</span> isnan(a) || isnan(b) || b &lt;= 0
            errordlg(<span class="string">'Invalid parameters (b &gt; 0)'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Load image first!'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Use filtered image if it exists, otherwise use original</span>
        <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        [rows, cols, ch] = size(img);

        <span class="comment">% Generate Rayleigh noise</span>
        noise = a + (-b*log(1 - rand(rows, cols, ch))).^0.5;
        noisy_img = double(img) + noise;

        <span class="comment">% Normalize to 0-255 range</span>
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show noisy result in axes2</span>
        axes(handles.axes2);
        imshow(noisy_img);
        title(<span class="string">'Rayleigh Noise Added'</span>);

        <span class="comment">% Store for next operation</span>
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Error'</span>);
    <span class="keyword">end</span>

<span class="comment">% --- Executes on button press in pushbutton22 (Exponential Noise).</span>
<span class="keyword">function</span> pushbutton22_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        a = str2double(get(handles.edit17, <span class="string">'String'</span>));
        b = str2double(get(handles.edit18, <span class="string">'String'</span>));

        <span class="keyword">if</span> isnan(a) || isnan(b) || a &lt;= 0
            errordlg(<span class="string">'Invalid parameters (a &gt; 0)'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Load image first!'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Use filtered image if it exists, otherwise use original</span>
        <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        [rows, cols, ch] = size(img);

        <span class="comment">% Generate Exponential noise</span>
        noise = (-1/a)*log(1 - rand(rows, cols, ch));
        noisy_img = double(img) + b*noise;

        <span class="comment">% Normalize</span>
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show noisy result in axes2</span>
        axes(handles.axes2);
        imshow(noisy_img);
        title(<span class="string">'Exponential Noise Added'</span>);

        <span class="comment">% Store for next operation</span>
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Error'</span>);
    <span class="keyword">end</span>
<span class="keyword">function</span> edit17_Callback(hObject, eventdata, handles)
validateInput(hObject, 0.01, 100, false); <span class="comment">% Exponential a</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit17_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit18_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 255, true); <span class="comment">% Exponential b</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit18_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit19_Callback(hObject, eventdata, handles)
validateInput(hObject, 0.01, 255, false); <span class="comment">% Rayleigh b</span>
<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit19_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit20_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 255, true); <span class="comment">% Rayleigh a</span>
<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit20_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton24 (Gamma Noise).</span>
<span class="keyword">function</span> pushbutton24_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        a = str2double(get(handles.edit21, <span class="string">'String'</span>));
        b = str2double(get(handles.edit22, <span class="string">'String'</span>));

        <span class="keyword">if</span> isnan(a) || isnan(b) || a &lt;= 0 || b &lt;= 0
            errordlg(<span class="string">'Invalid parameters (a &gt; 0, b &gt; 0)'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Load image first!'</span>, <span class="string">'Error'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Use filtered image if it exists, otherwise use original</span>
        <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        [rows, cols, ch] = size(img);

        <span class="comment">% Generate Gamma noise</span>
        <span class="keyword">if</span> exist(<span class="string">'gamrnd'</span>, <span class="string">'file'</span>)
            noise = gamrnd(a, b, rows, cols, ch);
        <span class="keyword">else</span>
            noise = zeros(rows, cols, ch);
            <span class="keyword">for</span> k = 1:a
                noise = noise - b*log(1 - rand(rows, cols, ch));
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        noisy_img = double(img) + noise;

        <span class="comment">% Normalize</span>
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show noisy result in axes2</span>
        axes(handles.axes2);
        imshow(noisy_img);
        title(<span class="string">'Gamma Noise Added'</span>);

        <span class="comment">% Store for next operation</span>
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Error'</span>);
    <span class="keyword">end</span>
<span class="comment">% --- Executes on selection change in popupmenu7.</span>
<span class="keyword">function</span> popupmenu7_Callback(hObject, eventdata, handles)
    <span class="comment">% No special handling needed here - we'll use the selection in the apply button</span>
    guidata(hObject, handles);
<span class="keyword">function</span> popupmenu7_CreateFcn(hObject, eventdata, handles)
    <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
        set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
    <span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton25.</span>
<span class="keyword">function</span> pushbutton25_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to pushbutton25 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>



<span class="keyword">function</span> edit21_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); <span class="comment">% Gamma a</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit21_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit22_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 255, true); <span class="comment">% Gamma b</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit22_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in pushbutton56.</span>
<span class="keyword">function</span> pushbutton56_Callback(hObject, eventdata, handles)
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Get threshold value</span>
    threshold = str2double(get(handles.edit29, <span class="string">'String'</span>));
    <span class="keyword">if</span> isnan(threshold) || threshold &lt; 0 || threshold &gt; 255
        errordlg(<span class="string">'Threshold must be between 0-255!'</span>, <span class="string">'Invalid Threshold'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Convert to grayscale first if color image</span>
    <span class="keyword">if</span> size(handles.currentImage, 3) == 3
        grayImg = rgb2gray(handles.currentImage);
    <span class="keyword">else</span>
        grayImg = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Convert to binary</span>
    handles.processedImage = imbinarize(grayImg, threshold/255);

    <span class="comment">% Display result</span>
    axes(handles.axes2);
    imshow(handles.processedImage);
    title([<span class="string">'Binary Image (Threshold: '</span> num2str(threshold) <span class="string">')'</span>]);

    guidata(hObject, handles);
<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in binary conversion: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>
<span class="comment">% --- Executes on button press in pushbutton58.</span>
<span class="keyword">function</span> pushbutton58_Callback(hObject, eventdata, handles)
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Get conversion method</span>
    method = round(str2double(get(handles.edit30, <span class="string">'String'</span>)));
    <span class="keyword">if</span> isnan(method) || method &lt; 1 || method &gt; 5
        errordlg(<span class="string">'Method must be 1-5!'</span>, <span class="string">'Invalid Method'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Apply selected grayscale conversion</span>
    <span class="keyword">if</span> size(handles.currentImage, 3) == 3
        <span class="keyword">switch</span> method
            <span class="keyword">case</span> 1 <span class="comment">% Gray by Division (average)</span>
                grayImg = mean(handles.currentImage, 3);
            <span class="keyword">case</span> 2 <span class="comment">% Gray by Percentage (weighted)</span>
                weights = [0.2989, 0.5870, 0.1140]; <span class="comment">% Standard luminance weights</span>
                grayImg = handles.currentImage(:,:,1)*weights(1) + <span class="keyword">...</span>
                         handles.currentImage(:,:,2)*weights(2) + <span class="keyword">...</span>
                         handles.currentImage(:,:,3)*weights(3);
            <span class="keyword">case</span> 3 <span class="comment">% Red channel</span>
                grayImg = handles.currentImage(:,:,1);
            <span class="keyword">case</span> 4 <span class="comment">% Green channel</span>
                grayImg = handles.currentImage(:,:,2);
            <span class="keyword">case</span> 5 <span class="comment">% Blue channel</span>
                grayImg = handles.currentImage(:,:,3);
        <span class="keyword">end</span>
        handles.processedImage = uint8(grayImg);
    <span class="keyword">else</span>
        handles.processedImage = handles.currentImage; <span class="comment">% Already grayscale</span>
    <span class="keyword">end</span>

    <span class="comment">% Display result</span>
    axes(handles.axes2);
    imshow(handles.processedImage);

    <span class="comment">% Set appropriate title</span>
    methodNames = {<span class="string">'Average'</span>, <span class="string">'Luminance'</span>, <span class="string">'Red Channel'</span>, <span class="string">'Green Channel'</span>, <span class="string">'Blue Channel'</span>};
    title([<span class="string">'Grayscale ('</span> methodNames{method} <span class="string">')'</span>]);

    guidata(hObject, handles);
<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in grayscale conversion: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>


<span class="keyword">function</span> edit29_Callback(hObject, eventdata, handles)
<span class="comment">% Validate binary threshold input</span>
val = str2double(get(hObject, <span class="string">'String'</span>));
<span class="keyword">if</span> isnan(val) || val &lt; 0 || val &gt; 255
    errordlg(<span class="string">'Threshold must be 0-255!'</span>, <span class="string">'Invalid Input'</span>);
    set(hObject, <span class="string">'String'</span>, <span class="string">'127'</span>); <span class="comment">% Reset to default</span>
<span class="keyword">end</span>

<span class="keyword">function</span> edit29_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>
set(hObject, <span class="string">'String'</span>, <span class="string">'127'</span>); <span class="comment">% Default threshold</span>

<span class="keyword">function</span> edit30_Callback(hObject, eventdata, handles)
<span class="comment">% Validate grayscale method input</span>
val = round(str2double(get(hObject, <span class="string">'String'</span>)));
<span class="keyword">if</span> isnan(val) || val &lt; 1 || val &gt; 5
    errordlg(<span class="string">'Method must be 1-5!'</span>, <span class="string">'Invalid Input'</span>);
    set(hObject, <span class="string">'String'</span>, <span class="string">'1'</span>); <span class="comment">% Reset to default</span>
<span class="keyword">end</span>

<span class="keyword">function</span> edit30_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>
set(hObject, <span class="string">'String'</span>, <span class="string">'1'</span>); <span class="comment">% Default method</span>


<span class="keyword">function</span> pushbutton52_Callback(hObject, eventdata, handles)
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    value = str2double(get(handles.edit28, <span class="string">'String'</span>));
    <span class="keyword">if</span> isnan(value)
        errordlg(<span class="string">'Please enter a valid number!'</span>, <span class="string">'Invalid Input'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Add value to each pixel (clamping to 255)</span>
    adjusted = double(img) + value;
    handles.filteredImage = uint8(min(adjusted, 255));

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Display result</span>
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title([<span class="string">'Brightness Increased (Add '</span> num2str(value) <span class="string">')'</span>]);

    guidata(hObject, handles);
<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>

<span class="keyword">function</span> pushbutton53_Callback(hObject, eventdata, handles)
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    value = str2double(get(handles.edit28, <span class="string">'String'</span>));
    <span class="keyword">if</span> isnan(value) || value &lt;= 0
        errordlg(<span class="string">'Please enter a positive number!'</span>, <span class="string">'Invalid Input'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Multiply each pixel (clamping to 255)</span>
    adjusted = double(img) * value;
    handles.filteredImage = uint8(min(adjusted, 255));

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Display result</span>
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title([<span class="string">'Brightness Increased (Multiply by '</span> num2str(value) <span class="string">')'</span>]);

    guidata(hObject, handles);
<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>

<span class="keyword">function</span> pushbutton54_Callback(hObject, eventdata, handles)
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    value = str2double(get(handles.edit28, <span class="string">'String'</span>));
    <span class="keyword">if</span> isnan(value)
        errordlg(<span class="string">'Please enter a valid number!'</span>, <span class="string">'Invalid Input'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Subtract value from each pixel (clamping to 0)</span>
    adjusted = double(img) - value;
    handles.filteredImage = uint8(max(adjusted, 0));

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Display result</span>
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title([<span class="string">'Brightness Decreased (Subtract '</span> num2str(value) <span class="string">')'</span>]);

    guidata(hObject, handles);
<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>

<span class="keyword">function</span> pushbutton55_Callback(hObject, eventdata, handles)
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    value = str2double(get(handles.edit28, <span class="string">'String'</span>));
    <span class="keyword">if</span> isnan(value) || value &lt;= 0
        errordlg(<span class="string">'Please enter a positive number!'</span>, <span class="string">'Invalid Input'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Divide each pixel (clamping to 0)</span>
    adjusted = double(img) / value;
    handles.filteredImage = uint8(max(adjusted, 0));

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Display result</span>
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title([<span class="string">'Brightness Decreased (Divide by '</span> num2str(value) <span class="string">')'</span>]);

    guidata(hObject, handles);
<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>

<span class="keyword">function</span> edit28_Callback(hObject, eventdata, handles)
<span class="comment">% Validate input</span>
value = str2double(get(hObject, <span class="string">'String'</span>));
<span class="keyword">if</span> isnan(value)
    errordlg(<span class="string">'Please enter a valid number!'</span>, <span class="string">'Invalid Input'</span>);
    set(hObject, <span class="string">'String'</span>, <span class="string">'10'</span>); <span class="comment">% Reset to default</span>
<span class="keyword">end</span>
handles.brightnessValue = value;
guidata(hObject, handles);

<span class="keyword">function</span> edit28_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>
set(hObject, <span class="string">'String'</span>, <span class="string">'10'</span>); <span class="comment">% Default value</span>


<span class="keyword">function</span> edit26_Callback(hObject, eventdata, handles)
<span class="comment">% D0 cutoff frequency - no action needed</span>

<span class="keyword">function</span> edit26_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>
set(hObject, <span class="string">'String'</span>, <span class="string">'5'</span>); <span class="comment">% Default D0 value</span>

<span class="keyword">function</span> edit27_Callback(hObject, eventdata, handles)
<span class="comment">% Butterworth order - no action needed</span>

<span class="keyword">function</span> edit27_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>
set(hObject, <span class="string">'String'</span>, <span class="string">'1'</span>); <span class="comment">% Default Butterworth order</span>


<span class="comment">% --- Executes on selection change in popupmenu10.</span>
<span class="keyword">function</span> popupmenu10_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu10 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu10 contents as cell array</span>
<span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu10</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> popupmenu10_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to popupmenu10 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>

<span class="comment">% Helper function for Ideal Filter</span>
<span class="keyword">function</span> output = idealFilter(img, D0, type)
    [M, N] = size(img);
    [u, v] = meshgrid(1:N, 1:M);
    D = sqrt((u - N/2).^2 + (v - M/2).^2);

    <span class="keyword">if</span> strcmpi(type, <span class="string">'low'</span>)
        H = double(D &lt;= D0);
    <span class="keyword">else</span> <span class="comment">% high pass</span>
        H = double(D &gt; D0);
    <span class="keyword">end</span>

    output = applyFrequencyFilter(img, H);

<span class="comment">% Helper function for Butterworth Filter</span>
<span class="keyword">function</span> output = butterworthFilter(img, D0, n, type)
    [M, N] = size(img);
    [u, v] = meshgrid(1:N, 1:M);
    D = sqrt((u - N/2).^2 + (v - M/2).^2);

    <span class="keyword">if</span> strcmpi(type, <span class="string">'low'</span>)
        H = 1 ./ (1 + (D./D0).^(2*n));
    <span class="keyword">else</span> <span class="comment">% high pass</span>
        H = 1 ./ (1 + (D0./D).^(2*n));
    <span class="keyword">end</span>

    output = applyFrequencyFilter(img, H);

<span class="comment">% Helper function for Gaussian Filter</span>
<span class="keyword">function</span> output = gaussianFilter(img, D0, type)
    [M, N] = size(img);
    [u, v] = meshgrid(1:N, 1:M);
    D = sqrt((u - N/2).^2 + (v - M/2).^2);

    <span class="keyword">if</span> strcmpi(type, <span class="string">'low'</span>)
        H = exp(-(D.^2)./(2*D0^2));
    <span class="keyword">else</span> <span class="comment">% high pass</span>
        H = 1 - exp(-(D.^2)./(2*D0^2));
    <span class="keyword">end</span>

    output = applyFrequencyFilter(img, H);
<span class="comment">% Common frequency filter application</span>
<span class="keyword">function</span> output = applyFrequencyFilter(img, H)
    <span class="comment">% Convert to double</span>
    img = im2double(img);

    <span class="comment">% Compute DFT</span>
    F = fftshift(fft2(img));

    <span class="comment">% Apply filter</span>
    G = H .* F;

    <span class="comment">% Inverse DFT</span>
    output = real(ifft2(ifftshift(G)));

    <span class="comment">% Normalize to 0-1 range</span>
    output = mat2gray(output);
<span class="comment">% --- Executes on button press in pushbutton50 (Apply Frequency Filter).</span>
<span class="keyword">function</span> pushbutton50_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Get parameters from GUI</span>
    D0 = str2double(get(handles.edit26, <span class="string">'String'</span>));
    n = str2double(get(handles.edit27, <span class="string">'String'</span>)); <span class="comment">% For Butterworth</span>
    filterTypes = get(handles.popupmenu10, <span class="string">'String'</span>);
    filterType = get(handles.popupmenu10, <span class="string">'Value'</span>);
    selectedFilterName = filterTypes{filterType}; <span class="comment">% Get the name of selected filter</span>

    <span class="comment">% Validate parameters</span>
    <span class="keyword">if</span> isnan(D0) || D0 &lt;= 0
        errordlg(<span class="string">'Please enter a valid positive D0 value!'</span>, <span class="string">'Invalid Parameter'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="keyword">if</span> (filterType == 3 || filterType == 4) &amp;&amp; (isnan(n) || n &lt;= 0)
        errordlg(<span class="string">'Please enter a valid positive Butterworth order!'</span>, <span class="string">'Invalid Parameter'</span>);
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Convert to grayscale if color image</span>
    <span class="keyword">if</span> size(handles.currentImage, 3) == 3
        img = rgb2gray(handles.currentImage);
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Apply selected frequency domain filter</span>
    <span class="keyword">switch</span> filterType
        <span class="keyword">case</span> 1 <span class="comment">% Ideal Low Pass</span>
            filtered = idealFilter(img, D0, <span class="string">'low'</span>);
        <span class="keyword">case</span> 2 <span class="comment">% Ideal High Pass</span>
            filtered = idealFilter(img, D0, <span class="string">'high'</span>);
        <span class="keyword">case</span> 3 <span class="comment">% Butterworth Low Pass</span>
            filtered = butterworthFilter(img, D0, n, <span class="string">'low'</span>);
        <span class="keyword">case</span> 4 <span class="comment">% Butterworth High Pass</span>
            filtered = butterworthFilter(img, D0, n, <span class="string">'high'</span>);
        <span class="keyword">case</span> 5 <span class="comment">% Gaussian Low Pass</span>
            filtered = gaussianFilter(img, D0, <span class="string">'low'</span>);
        <span class="keyword">case</span> 6 <span class="comment">% Gaussian High Pass</span>
            filtered = gaussianFilter(img, D0, <span class="string">'high'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Show result in axes2</span>
    axes(handles.axes2);
    imshow(filtered);
    title([selectedFilterName <span class="string">' Filter'</span>]);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = filtered;
    guidata(hObject, handles);

<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in frequency filtering: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>
<span class="comment">% --- Executes on button press in pushbutton45 (Fourier Transform).</span>
<span class="keyword">function</span> pushbutton45_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image is loaded</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Convert to grayscale if color image</span>
    <span class="keyword">if</span> size(handles.currentImage, 3) == 3
        img = rgb2gray(handles.currentImage);
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Compute Fourier Transform</span>
    f_img = fft2(double(img));
    fshift = fftshift(f_img);
    magnitude_spectrum = mat2gray(log(1 + abs(fshift)));

    <span class="comment">% Store Fourier data</span>
    handles.fourierData = fshift;

    <span class="comment">% Display magnitude spectrum</span>
    axes(handles.axes2);
    imshow(magnitude_spectrum, []);
    colormap(handles.axes2, gray); <span class="comment">% Use colormap for better visualization</span>
    colorbar(handles.axes2);
    title(<span class="string">'Fourier Transform (Magnitude Spectrum)'</span>);

    <span class="comment">% Update handles</span>
    guidata(hObject, handles);

<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in Fourier Transform: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in pushbutton46 (Inverse Fourier Transform).</span>
<span class="keyword">function</span> pushbutton46_Callback(hObject, eventdata, handles)
<span class="comment">% Check if Fourier data exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'fourierData'</span>) || isempty(handles.fourierData)
    errordlg(<span class="string">'Please perform Fourier Transform first!'</span>, <span class="string">'No Fourier Data'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Compute Inverse Fourier Transform</span>
    f_ishift = ifftshift(handles.fourierData);
    img_back = ifft2(f_ishift);

    <span class="comment">% Display reconstructed image</span>
    axes(handles.axes2);
    imshow(img_back, []);
    title(<span class="string">'Inverse Fourier Transform (Reconstructed Image)'</span>);
    colorbar(handles.axes2, <span class="string">'off'</span>); <span class="comment">% Remove colorbar for spatial domain</span>

    <span class="comment">% Store reconstructed image</span>
    handles.reconstructedImage = img_back;

    <span class="comment">% Update handles</span>
    guidata(hObject, handles);

<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in Inverse Fourier Transform: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>


<span class="keyword">function</span> edit24_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to edit24 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Hints: get(hObject,'String') returns contents of edit24 as text</span>
<span class="comment">%        str2double(get(hObject,'String')) returns contents of edit24 as a double</span>


<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit24_CreateFcn(hObject, eventdata, handles)
<span class="comment">% hObject    handle to edit24 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>

<span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
<span class="comment">%       See ISPC and COMPUTER.</span>
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>


<span class="comment">% --- Executes on button press in pushbutton42.</span>
<span class="comment">% --- Executes on button press in pushbutton42.</span>
<span class="keyword">function</span> pushbutton42_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to pushbutton42 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

[filename, pathname] = uigetfile({<span class="string">'*.jpg;*.png;*.bmp;*.tif;*.tiff'</span>, <span class="string">'Image Files'</span>}, <span class="string">'Select an Image'</span>);
<span class="keyword">if</span> isequal(filename, 0)
    <span class="keyword">return</span>; <span class="comment">% User cancelled</span>
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Read and store the image</span>
    img = imread(fullfile(pathname, filename));
    handles.currentImage = img;

    <span class="comment">% Display the original image</span>
    axes(handles.axes1); <span class="comment">% Make sure you have an axes component named axes1</span>
    imshow(img);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Update handles structure</span>
    guidata(hObject, handles);
<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error loading image: '</span> e.message], <span class="string">'Image Load Error'</span>);
<span class="keyword">end</span>
<span class="comment">% --- Executes on button press in pushbutton43.</span>
<span class="comment">% --- Executes on button press in pushbutton43.</span>
<span class="keyword">function</span> pushbutton43_Callback(hObject, eventdata, handles)
<span class="comment">% hObject    handle to pushbutton43 (see GCBO)</span>
<span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
<span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>

<span class="comment">% Check if there's a filtered image to save</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'filteredImage'</span>) || isempty(handles.filteredImage)
    errordlg(<span class="string">'No filtered image available to save. Please apply a filter first.'</span>, <span class="string">'Nothing to Save'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">% Get the filtered image</span>
filteredImg = handles.filteredImage;

<span class="comment">% Prepare default filename with timestamp</span>
defaultName = [<span class="string">'filtered_'</span> datestr(now, <span class="string">'yyyymmdd_HHMMSS'</span>) <span class="string">'.png'</span>];

<span class="comment">% Ask user for save location</span>
[filename, pathname] = uiputfile(<span class="keyword">...</span>
    {<span class="string">'*.png'</span>,<span class="string">'PNG files (*.png)'</span>; <span class="keyword">...</span>
     <span class="string">'*.jpg'</span>,<span class="string">'JPEG files (*.jpg)'</span>; <span class="keyword">...</span>
     <span class="string">'*.tif'</span>,<span class="string">'TIFF files (*.tif)'</span>; <span class="keyword">...</span>
     <span class="string">'*.*'</span>,<span class="string">'All Files (*.*)'</span>}, <span class="keyword">...</span>
    <span class="string">'Save Filtered Image As'</span>, <span class="keyword">...</span>
    defaultName);

<span class="keyword">if</span> isequal(filename, 0) || isequal(pathname, 0)
    <span class="keyword">return</span>; <span class="comment">% User cancelled</span>
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Save the image with appropriate format</span>
    [~, ~, ext] = fileparts(filename);
    <span class="keyword">switch</span> lower(ext)
        <span class="keyword">case</span> <span class="string">'.png'</span>
            imwrite(filteredImg, fullfile(pathname, filename), <span class="string">'png'</span>);
        <span class="keyword">case</span> <span class="string">'.jpg'</span>
            imwrite(filteredImg, fullfile(pathname, filename), <span class="string">'jpg'</span>, <span class="string">'Quality'</span>, 90);
        <span class="keyword">case</span> <span class="string">'.tif'</span>
            imwrite(filteredImg, fullfile(pathname, filename), <span class="string">'tif'</span>);
        <span class="keyword">otherwise</span>
            <span class="comment">% Default to PNG if extension not recognized</span>
            imwrite(filteredImg, fullfile(pathname, [filename <span class="string">'.png'</span>]), <span class="string">'png'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Notify user of successful save</span>
    msgbox([<span class="string">'Image successfully saved to: '</span> fullfile(pathname, filename)], <span class="string">'Save Complete'</span>);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error saving image: '</span> e.message], <span class="string">'Save Error'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in pushbutton37 (Negative).</span>
<span class="keyword">function</span> pushbutton37_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists and is loaded</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image Loaded'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Apply negative transformation</span>
    negative = 255 - img;

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Show result in axes2</span>
    axes(handles.axes2);
    imshow(negative);
    title(<span class="string">'Negative Transform'</span>);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = negative;
    guidata(hObject, handles);

<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in negative transformation: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>
<span class="comment">% --- Executes on button press in pushbutton40 (Log).</span>
<span class="keyword">function</span> pushbutton40_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists and is loaded</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image Loaded'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Convert image to double and normalize</span>
    img = im2double(img);

    <span class="comment">% Apply log transformation</span>
    c = 1/log(1 + max(img(:))); <span class="comment">% Scaling constant</span>
    logImg = c * log(1 + img);

    <span class="comment">% Convert back to uint8</span>
    transformed = im2uint8(logImg);

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Show result in axes2</span>
    axes(handles.axes2);
    imshow(transformed);
    title(<span class="string">'Log Transform'</span>);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = transformed;
    guidata(hObject, handles);

<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in log transformation: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>
<span class="comment">% --- Executes on button press in pushbutton41 (Gamma).</span>
<span class="keyword">function</span> pushbutton41_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists and is loaded</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image Loaded'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="keyword">try</span>
    <span class="comment">% Get gamma value from edit box</span>
    gammaStr = get(handles.edit23, <span class="string">'String'</span>);
    gamma = str2double(gammaStr);

    <span class="comment">% Validate gamma value</span>
    <span class="keyword">if</span> isnan(gamma) || gamma &lt;= 0
        errordlg(<span class="string">'Gamma must be a positive number!'</span>, <span class="string">'Invalid Gamma Value'</span>);
        set(handles.edit23, <span class="string">'String'</span>, <span class="string">'1.0'</span>); <span class="comment">% Reset to default</span>
        <span class="keyword">return</span>;
    <span class="keyword">end</span>

    <span class="comment">% Apply gamma transformation</span>
    img = im2double(handles.currentImage);
    gammaImg = img.^gamma;
    handles.filteredImage = im2uint8(gammaImg);

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title([<span class="string">'Gamma Correction (\gamma = '</span> num2str(gamma) <span class="string">')'</span>]);

    <span class="comment">% Show result in axes2</span>
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title([<span class="string">'Gamma Correction (\gamma = '</span> num2str(gamma) <span class="string">')'</span>]);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = handles.filteredImage;
    guidata(hObject, handles);

<span class="keyword">catch</span> ME
    errordlg([<span class="string">'Error in gamma transformation: '</span> ME.message], <span class="string">'Processing Error'</span>);
<span class="keyword">end</span>



<span class="keyword">function</span> edit23_Callback(hObject, eventdata, handles)
<span class="comment">% Get current gamma value</span>
gammaStr = get(hObject, <span class="string">'String'</span>);
gamma = str2double(gammaStr);

<span class="comment">% Validate input</span>
<span class="keyword">if</span> isnan(gamma) || gamma &lt;= 0
    errordlg(<span class="string">'Gamma must be a positive number!'</span>, <span class="string">'Invalid Input'</span>);
    set(hObject, <span class="string">'String'</span>, <span class="string">'1.0'</span>); <span class="comment">% Reset to default</span>
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">% If image is loaded, show preview</span>
<span class="keyword">if</span> isfield(handles, <span class="string">'currentImage'</span>) &amp;&amp; ~isempty(handles.currentImage)
    <span class="keyword">try</span>
        <span class="comment">% Create preview on a small version of the image</span>
        smallImg = imresize(handles.currentImage, 0.2); <span class="comment">% Reduce size for faster preview</span>
        previewImg = im2uint8(im2double(smallImg).^gamma);

        <span class="comment">% Display preview</span>
        axes(handles.axes2);
        imshow(previewImg);
        title([<span class="string">'Gamma Preview (\gamma='</span> gammaStr <span class="string">')'</span>]);
    <span class="keyword">catch</span>
        <span class="comment">% Fail silently for preview errors</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">% --- Executes during object creation, after setting all properties.</span>
<span class="keyword">function</span> edit23_CreateFcn(hObject, eventdata, handles)
<span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
    set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
<span class="keyword">end</span>
set(hObject, <span class="string">'String'</span>, <span class="string">'1.0'</span>); <span class="comment">% Default gamma value</span>
<span class="keyword">function</span> applyLineOperation(handles, direction)
    <span class="keyword">try</span>
        <span class="comment">% Check if image exists</span>
        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Get selected operation</span>
        operations = get(handles.popupmenu8, <span class="string">'String'</span>);
        selectedOp = operations{get(handles.popupmenu8, <span class="string">'Value'</span>)};

        <span class="comment">% Convert to grayscale if needed</span>
        <span class="keyword">if</span> size(handles.currentImage, 3) == 3
            img = rgb2gray(handles.currentImage);
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        <span class="comment">% Convert to double for processing</span>
        img = double(img);

        <span class="comment">% Apply the selected operation</span>
        <span class="keyword">switch</span> selectedOp
            <span class="keyword">case</span> <span class="string">'Line Detection (Sobel)'</span>
                <span class="keyword">switch</span> direction
                    <span class="keyword">case</span> <span class="string">'H'</span>
                        kernel = [-1 -2 -1; 0 0 0; 1 2 1]; <span class="comment">% Horizontal Sobel</span>
                    <span class="keyword">case</span> <span class="string">'V'</span>
                        kernel = [-1 0 1; -2 0 2; -1 0 1]; <span class="comment">% Vertical Sobel</span>
                    <span class="keyword">case</span> <span class="string">'DL'</span>
                        kernel = [0 1 2; -1 0 1; -2 -1 0]; <span class="comment">% Diagonal Left Sobel</span>
                    <span class="keyword">case</span> <span class="string">'DR'</span>
                        kernel = [-2 -1 0; -1 0 1; 0 1 2]; <span class="comment">% Diagonal Right Sobel</span>
                <span class="keyword">end</span>
                result = imfilter(img, kernel);

            <span class="keyword">case</span> <span class="string">'Line Detection (Roberts)'</span>
                <span class="keyword">switch</span> direction
                    <span class="keyword">case</span> <span class="string">'H'</span>
                        kernel = [1 0; 0 -1]; <span class="comment">% Horizontal Roberts</span>
                    <span class="keyword">case</span> <span class="string">'V'</span>
                        kernel = [0 1; -1 0]; <span class="comment">% Vertical Roberts</span>
                    <span class="keyword">case</span> <span class="string">'DL'</span>
                        kernel = [0 -1; 1 0]; <span class="comment">% Diagonal Left Roberts</span>
                    <span class="keyword">case</span> <span class="string">'DR'</span>
                        kernel = [-1 0; 0 1]; <span class="comment">% Diagonal Right Roberts</span>
                <span class="keyword">end</span>
                result = imfilter(img, kernel);

            <span class="keyword">case</span> <span class="string">'Line Sharpening'</span>
                <span class="keyword">switch</span> direction
                    <span class="keyword">case</span> <span class="string">'H'</span>
                        kernel = [0 -1 0; 0 3 0; 0 -1 0]; <span class="comment">% Horizontal sharpening</span>
                    <span class="keyword">case</span> <span class="string">'V'</span>
                        kernel = [0 0 0; -1 3 -1; 0 0 0]; <span class="comment">% Vertical sharpening</span>
                    <span class="keyword">case</span> <span class="string">'DL'</span>
                        kernel = [-1 0 0; 0 3 0; 0 0 -1]; <span class="comment">% Diagonal Left sharpening</span>
                    <span class="keyword">case</span> <span class="string">'DR'</span>
                        kernel = [0 0 -1; 0 3 0; -1 0 0]; <span class="comment">% Diagonal Right sharpening</span>
                <span class="keyword">end</span>
                result = imfilter(img, kernel);
        <span class="keyword">end</span>

        <span class="comment">% Normalize and convert to uint8</span>
        result = mat2gray(result); <span class="comment">% Normalize to [0,1]</span>
        result = im2uint8(result); <span class="comment">% Convert to uint8</span>

        <span class="comment">% Display results</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        axes(handles.axes2);
        imshow(result);
        title([selectedOp <span class="string">' ('</span> direction <span class="string">' Direction)'</span>]);

        <span class="comment">% Store result</span>
        handles.filteredImage = result;
        guidata(handles.figure1, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error in '</span> selectedOp <span class="string">': '</span> ME.message], <span class="string">'Processing Error'</span>);
    <span class="keyword">end</span>

<span class="comment">% --- Executes on selection change in popupmenu8 line detect and sharpening</span>
<span class="keyword">function</span> popupmenu8_Callback(hObject, eventdata, handles)
    <span class="comment">% Keep buttons visible for all operations</span>
    set([handles.pushbutton31, handles.pushbutton32, handles.pushbutton33, handles.pushbutton34], <span class="string">'Visible'</span>, <span class="string">'on'</span>);
    guidata(hObject, handles);

<span class="keyword">function</span> popupmenu8_CreateFcn(hObject, eventdata, handles)
    <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
        set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
    <span class="keyword">end</span>




<span class="comment">% --- Executes on button press in pushbutton27.</span>
<span class="keyword">function</span> pushbutton27_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Get selected operation</span>
        operations = get(handles.popupmenu8, <span class="string">'String'</span>);
        selectedOp = operations{get(handles.popupmenu8, <span class="string">'Value'</span>)};

        <span class="comment">% Convert to grayscale if needed</span>
        <span class="keyword">if</span> size(handles.currentImage, 3) == 3
            img = rgb2gray(handles.currentImage);
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        <span class="comment">% Apply selected operation</span>
        <span class="keyword">switch</span> selectedOp
            <span class="keyword">case</span> <span class="string">'Line Detection (Sobel)'</span>
                <span class="comment">% Default to horizontal for Sobel</span>
                result = edge(img, <span class="string">'sobel'</span>, <span class="string">'horizontal'</span>);

            <span class="keyword">case</span> <span class="string">'Line Detection (Roberts)'</span>
                <span class="comment">% Default to horizontal for Roberts</span>
                result = edge(img, <span class="string">'roberts'</span>, <span class="string">'horizontal'</span>);

            <span class="keyword">case</span> <span class="string">'Line Sharpening'</span>
                <span class="comment">% Unsharp masking for line sharpening</span>
                blurred = imgaussfilt(img, 1);
                mask = img - blurred;
                result = img + 1.5*mask; <span class="comment">% Increased sharpening factor</span>
                result = uint8(min(max(result, 0), 255));
        <span class="keyword">end</span>

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show result in axes2</span>
        axes(handles.axes2);
        imshow(result);
        title([selectedOp <span class="string">' Result'</span>]);

        <span class="comment">% Store result</span>
        handles.filteredImage = result;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error in '</span> selectedOp <span class="string">': '</span> ME.message], <span class="string">'Processing Error'</span>);
    <span class="keyword">end</span>

<span class="comment">% --- Direction buttons callbacks</span>
<span class="keyword">function</span> pushbutton31_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, <span class="string">'H'</span>);

<span class="keyword">function</span> pushbutton32_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, <span class="string">'V'</span>);

<span class="keyword">function</span> pushbutton33_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, <span class="string">'DL'</span>);

<span class="keyword">function</span> pushbutton34_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, <span class="string">'DR'</span>);

<span class="comment">% --- Executes on button press in pushbutton28 (Apply Point Operation)</span>
<span class="keyword">function</span> pushbutton28_Callback(hObject, eventdata, handles)
    <span class="keyword">try</span>
        <span class="comment">% Check if image exists</span>
        <span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
            errordlg(<span class="string">'Please load an image first!'</span>, <span class="string">'No Image'</span>);
            <span class="keyword">return</span>;
        <span class="keyword">end</span>

        <span class="comment">% Get selected operation</span>
        operations = get(handles.popupmenu7, <span class="string">'String'</span>);
        selectedOp = operations{get(handles.popupmenu7, <span class="string">'Value'</span>)};

        <span class="comment">% Convert to grayscale if color image</span>
        <span class="keyword">if</span> size(handles.currentImage, 3) == 3
            img = rgb2gray(handles.currentImage);
        <span class="keyword">else</span>
            img = handles.currentImage;
        <span class="keyword">end</span>

        <span class="comment">% Apply selected operation</span>
        <span class="keyword">switch</span> selectedOp
            <span class="keyword">case</span> <span class="string">'Point Detection'</span>
                <span class="comment">% Laplacian for point detection</span>
                h = [1 1 1; 1 -8 1; 1 1 1]; <span class="comment">% Laplacian kernel</span>
                filtered = imfilter(double(img), h, <span class="string">'same'</span>);
                result = abs(filtered); <span class="comment">% Get absolute values</span>
                result = uint8(255 * mat2gray(result)); <span class="comment">% Normalize to 0-255</span>

            <span class="keyword">case</span> <span class="string">'Point Sharpening'</span>
                <span class="comment">% Unsharp masking for sharpening</span>
                blurred = imgaussfilt(img, 2);
                mask = img - blurred;
                result = img + mask; <span class="comment">% Add the mask back to original</span>
                result = uint8(min(max(result, 0), 255)); <span class="comment">% Clamp to 0-255</span>
        <span class="keyword">end</span>

        <span class="comment">% Always show original in axes1</span>
        axes(handles.axes1);
        imshow(handles.currentImage);
        title(<span class="string">'Original Image'</span>);

        <span class="comment">% Show result in axes2</span>
        axes(handles.axes2);
        imshow(result);
        title(selectedOp);

        <span class="comment">% Store result</span>
        handles.filteredImage = result;
        guidata(hObject, handles);

    <span class="keyword">catch</span> ME
        errordlg([<span class="string">'Error in '</span> selectedOp <span class="string">': '</span> ME.message], <span class="string">'Processing Error'</span>);
    <span class="keyword">end</span>
<span class="comment">% --- Executes on button press in pushbutton29.</span>
<span class="keyword">function</span> pushbutton29_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first.'</span>, <span class="string">'No Image Found'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">% Get selected filter</span>
filterList = get(handles.popupmenu6, <span class="string">'String'</span>);
selectedFilter = filterList{get(handles.popupmenu6, <span class="string">'Value'</span>)};

<span class="keyword">try</span>
    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    originalImg = img; <span class="comment">% Keep copy of original for histogram</span>

    <span class="comment">% Convert to grayscale if RGB (most noise filters work on grayscale)</span>
    <span class="keyword">if</span> size(img, 3) == 3
        img = rgb2gray(img);
        isRGB = true;
    <span class="keyword">else</span>
        isRGB = false;
    <span class="keyword">end</span>

    <span class="comment">% Apply selected filter</span>
    <span class="keyword">switch</span> selectedFilter
        <span class="keyword">case</span> <span class="string">'Min Filter'</span>
            filteredImg = ordfilt2(img, 1, ones(handles.kernelSize));
        <span class="keyword">case</span> <span class="string">'Max Filter'</span>
            filteredImg = ordfilt2(img, handles.kernelSize^2, ones(handles.kernelSize));
        <span class="keyword">case</span> <span class="string">'Mean Filter'</span>
            h = fspecial(<span class="string">'average'</span>, handles.kernelSize);
            filteredImg = imfilter(img, h);
        <span class="keyword">case</span> <span class="string">'Median Filter'</span>
            filteredImg = medfilt2(img, [handles.kernelSize handles.kernelSize]);
        <span class="keyword">case</span> <span class="string">'Midpoint Filter'</span>
            minImg = ordfilt2(img, 1, ones(handles.kernelSize));
            maxImg = ordfilt2(img, handles.kernelSize^2, ones(handles.kernelSize));
            filteredImg = (double(minImg) + double(maxImg)) / 2;
            filteredImg = uint8(filteredImg);
    <span class="keyword">end</span>

    <span class="comment">% Convert back to RGB if original was RGB</span>
    <span class="keyword">if</span> isRGB
        filteredImg = cat(3, filteredImg, filteredImg, filteredImg);
    <span class="keyword">end</span>

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Show filtered result in axes2</span>
    axes(handles.axes2);
    imshow(filteredImg);
    title([selectedFilter <span class="string">' Result'</span>]);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = filteredImg;
    guidata(hObject, handles);

    <span class="comment">% Create figure for histogram comparison</span>
    hFig = figure(<span class="string">'Name'</span>, <span class="string">'Histogram Comparison'</span>, <span class="string">'NumberTitle'</span>, <span class="string">'off'</span>, <span class="string">'Position'</span>, [100 100 1000 800]);

    <span class="comment">% Original image</span>
    subplot(2,2,1);
    <span class="keyword">if</span> size(originalImg, 3) == 3
        imshow(originalImg);
        title(<span class="string">'Original Color Image'</span>);

        <span class="comment">% RGB histograms</span>
        subplot(2,2,3);
        imhist(originalImg(:,:,1));
        hold <span class="string">on</span>;
        imhist(originalImg(:,:,2));
        imhist(originalImg(:,:,3));
        hold <span class="string">off</span>;
        title(<span class="string">'Original RGB Histograms'</span>);
        legend(<span class="string">'Red'</span>,<span class="string">'Green'</span>,<span class="string">'Blue'</span>);
    <span class="keyword">else</span>
        imshow(originalImg);
        title(<span class="string">'Original Grayscale Image'</span>);

        subplot(2,2,3);
        imhist(originalImg);
        title(<span class="string">'Original Histogram'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Processed image</span>
    subplot(2,2,2);
    imshow(filteredImg);
    title([selectedFilter <span class="string">' Result'</span>]);

    subplot(2,2,4);
    <span class="keyword">if</span> isRGB
        imhist(filteredImg(:,:,1));
        hold <span class="string">on</span>;
        imhist(filteredImg(:,:,2));
        imhist(filteredImg(:,:,3));
        hold <span class="string">off</span>;
        title(<span class="string">'Processed RGB Histograms'</span>);
        legend(<span class="string">'Red'</span>,<span class="string">'Green'</span>,<span class="string">'Blue'</span>);
    <span class="keyword">else</span>
        imhist(filteredImg);
        title(<span class="string">'Processed Histogram'</span>);
    <span class="keyword">end</span>

    <span class="comment">% Add main title (alternative to sgtitle for older MATLAB versions)</span>
    annotation(hFig, <span class="string">'textbox'</span>, [0.3 0.95 0.4 0.05], <span class="string">'String'</span>, <span class="keyword">...</span>
        [<span class="string">'Histogram Comparison: '</span> selectedFilter <span class="string">' (Kernel: '</span> num2str(handles.kernelSize) <span class="string">'x'</span> num2str(handles.kernelSize) <span class="string">')'</span>], <span class="keyword">...</span>
        <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'HorizontalAlignment'</span>, <span class="string">'center'</span>, <span class="keyword">...</span>
        <span class="string">'FontSize'</span>, 12, <span class="string">'FontWeight'</span>, <span class="string">'bold'</span>);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error applying '</span> selectedFilter <span class="string">': '</span> e.message], <span class="string">'Filter Error'</span>);
<span class="keyword">end</span>

<span class="comment">% --- Executes on button press in pushbutton30.</span>
<span class="keyword">function</span> pushbutton30_Callback(hObject, eventdata, handles)
<span class="comment">% Check if image exists</span>
<span class="keyword">if</span> ~isfield(handles, <span class="string">'currentImage'</span>) || isempty(handles.currentImage)
    errordlg(<span class="string">'Please load an image first.'</span>, <span class="string">'No Image Found'</span>);
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">% Get selected filter</span>
filterList = get(handles.popupmenu3, <span class="string">'String'</span>);
selectedFilter = filterList{get(handles.popupmenu3, <span class="string">'Value'</span>)};

<span class="keyword">try</span>
    <span class="comment">% Use filtered image if it exists, otherwise use original</span>
    <span class="keyword">if</span> isfield(handles, <span class="string">'filteredImage'</span>) &amp;&amp; ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    <span class="keyword">else</span>
        img = handles.currentImage;
    <span class="keyword">end</span>

    <span class="comment">% Convert to grayscale if RGB</span>
    <span class="keyword">if</span> size(img, 3) == 3
        img = rgb2gray(img);
    <span class="keyword">end</span>

    <span class="comment">% Apply selected filter</span>
    <span class="keyword">switch</span> selectedFilter
        <span class="keyword">case</span> <span class="string">'Min Filter'</span>
            filteredImg = ordfilt2(img, 1, ones(3,3));

        <span class="keyword">case</span> <span class="string">'Max Filter'</span>
            filteredImg = ordfilt2(img, 9, ones(3,3));

        <span class="keyword">case</span> <span class="string">'Mean Filter'</span>
            h = fspecial(<span class="string">'average'</span>, 3);
            filteredImg = imfilter(img, h);

        <span class="keyword">case</span> <span class="string">'Midpoint Filter'</span>
            minImg = ordfilt2(img, 1, ones(3,3));
            maxImg = ordfilt2(img, 9, ones(3,3));
            filteredImg = (double(minImg) + double(maxImg)) / 2;
            filteredImg = uint8(filteredImg);

        <span class="keyword">case</span> <span class="string">'Median Filter'</span>
            filteredImg = medfilt2(img, [3 3]);

    <span class="keyword">end</span>

    <span class="comment">% Always show original in axes1</span>
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(<span class="string">'Original Image'</span>);

    <span class="comment">% Show filtered result in axes2</span>
    axes(handles.axes2);
    imshow(filteredImg);
    title([selectedFilter <span class="string">' Result'</span>]);

    <span class="comment">% Store for next operation</span>
    handles.filteredImage = filteredImg;
    guidata(hObject, handles);

<span class="keyword">catch</span> e
    errordlg([<span class="string">'Error applying '</span> selectedFilter <span class="string">': '</span> e.message], <span class="string">'Filter Error'</span>);
<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="gui_01.png" style="width:1470px;height:715px;" alt=""> <p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
function varargout = gui(varargin)
% Begin initialization code - DO NOT EDIT
gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
                   'gui_Singleton',  gui_Singleton, ...
                   'gui_OpeningFcn', @gui_OpeningFcn, ...
                   'gui_OutputFcn',  @gui_OutputFcn, ...
                   'gui_LayoutFcn',  [] , ...
                   'gui_Callback',   []);
if nargin && ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    gui_mainfcn(gui_State, varargin{:});
end
% End initialization code - DO NOT EDIT


% REPLACE_WITH_DASH_DASH- Executes just before gui is made visible.
function gui_OpeningFcn(hObject, ~, handles, varargin)
% Initialize filter options
set(handles.popupmenu1, 'String', {'Correlation', 'Weighted'});
set(handles.popupmenu1, 'Value', 1);
set(handles.edit1, 'String', '0');
set(handles.edit2, 'String', '255');

% Initialize default kernel
handles.filterKernel = ones(3,3)/9;
if isfield(handles, 'uitable3')
    set(handles.uitable3, 'Data', num2cell(handles.filterKernel));
end

% Initialize non-linear filter options
nonLinearFilters = {
    'Min Filter', 
    'Max Filter', 
    'Mean Filter', 
    'Midpoint Filter', 
    'Median Filter'
    };
set(handles.popupmenu3, 'String', nonLinearFilters);
set(handles.popupmenu3, 'Value', 1); % Default to first option

noiseFilters = {
    'Min Filter', 
    'Max Filter', 
    'Mean Filter', 
    'Median Filter', 
    'Midpoint Filter'
};

set(handles.popupmenu6, 'String', noiseFilters); % Assuming popupmenu3 is for noise filters
set(handles.popupmenu6, 'Value', 1); % Default to first option

set(handles.edit7, 'String', '0.05');  % Salt & Pepper PS
set(handles.edit8, 'String', '0.05');  % Salt & Pepper PP
set(handles.edit9, 'String', '10');    % Uniform a
set(handles.edit10, 'String', '200');  % Uniform b
set(handles.edit11, 'String', '10');   % Uniform P
set(handles.edit12, 'String', '10');   % Gaussian seg
set(handles.edit13, 'String', '10');   % Gaussian m
set(handles.edit14, 'String', '10');   % Gaussian P
set(handles.edit17, 'String', '10');   % Exponential a
set(handles.edit18, 'String', '200');  % Exponential b
set(handles.edit19, 'String', '240');  % Rayleigh b
set(handles.edit20, 'String', '240');  % Rayleigh a
set(handles.edit21, 'String', '0');    % Gamma a
set(handles.edit22, 'String', '255');  % Gamma b
% Initialize image fields
handles.currentImage = [];
handles.filteredImage = [];
% Initialize point operations menu
pointOperations = {'Point Detection', 'Point Sharpening'};
set(handles.popupmenu7, 'String', pointOperations);
set(handles.popupmenu7, 'Value', 1); % Default to Point Detection
% Initialize line operations menu
lineOperations = {
    'Line Detection (Sobel)', 
    'Line Detection (Roberts)', 
    'Line Sharpening'
};
set(handles.popupmenu8, 'String', lineOperations);
set(handles.popupmenu8, 'Value', 1); % Default to Sobel
    
% Initialize direction buttons as invisible
set([handles.pushbutton31, handles.pushbutton32, handles.pushbutton33, handles.pushbutton34], 'Visible', 'on','Enable', 'on');
set(handles.pushbutton31, 'String', 'H');
set(handles.pushbutton32, 'String', 'V');
set(handles.pushbutton33, 'String', 'DL');
set(handles.pushbutton34, 'String', 'DR');
% Initialize transformation parameters
handles.transformationParams = struct(...
    'gammaValue', 1.0, ...      % Default gamma value
    'logConstant', 1.0, ...     % Constant for log transformation
    'negativeActive', false ...  % Flag for negative transformation
);

% Set default gamma value in the edit box
set(handles.edit23, 'String', num2str(handles.transformationParams.gammaValue));
% Initialize frequency domain filter parameters
set(handles.edit26, 'String', '5');  % D0 cutoff frequency
set(handles.edit27, 'String', '1');  % Butterworth order

% Initialize filter type popupmenu
filterTypes = {
    'Ideal Low Pass', 
    'Ideal High Pass', 
    'Butterworth Low Pass', 
    'Butterworth High Pass', 
    'Gaussian Low Pass', 
    'Gaussian High Pass'
};
set(handles.popupmenu10, 'String', filterTypes);
set(handles.popupmenu10, 'Value', 1); % Default to Ideal Low Pass
% Initialize brightness parameters
set(handles.edit28, 'String', '10');  % Default brightness adjustment value
handles.brightnessValue = 10; 
% Choose default command line output
handles.output = hObject;
handles.currentImage = [];
handles.noisyImage = [];
handles.frequencyFilteredImage = [];
% Initialize Fourier transform variables
handles.fourierData = [];       % Will store Fourier transform data
handles.reconstructedImage = []; % Will store reconstructed image
% Initialize conversion parameters
set(handles.edit29, 'String', '127');  % Default binary threshold
set(handles.edit30, 'String', '1');    % Default grayscale method (1-5)
% Initialize other variables
handles.currentImage = [];
handles.processedImage = [];
% Initialize default values for Fourier display
handles.fourierDisplayMode = 'magnitude'; % Can be 'magnitude' or 'phase'
% Initialize kernel size (default 3x3)
handles.kernelSize = 3;

% Update handles structure
guidata(hObject, handles);

% UIWAIT makes gui wait for user response (see UIRESUME)
% uiwait(handles.figure1);


% REPLACE_WITH_DASH_DASH- Outputs from this function are returned to the command line.
function varargout = gui_OutputFcn(hObject, eventdata, handles) 
% varargout  cell array for returning output args (see VARARGOUT);
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Get default command line output from handles structure
varargout{1} = handles.output;

% REPLACE_WITH_DASH_DASH- Helper function to validate numeric input
function valid = validateInput(handle, minVal, maxVal, isInteger)
str = get(handle, 'String');
num = str2double(str);
if isnan(num) || num < minVal || num > maxVal
    valid = false;
    set(handle, 'String', '');
    errordlg(sprintf('Please enter a number between %.2f and %.2f', minVal, maxVal), 'Invalid Input');
else
    if isInteger
        num = round(num);
        set(handle, 'String', num2str(num));
    end
    valid = true;
end
% REPLACE_WITH_DASH_DASH- Executes on selection change in popupmenu1.
function popupmenu1_Callback(hObject, eventdata, handles)
% hObject    handle to popupmenu1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
set(handles.uitable3, 'Data', handles.filterKernel);

% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu1 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from popupmenu1


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function popupmenu1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to popupmenu1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on selection change in listbox1.
function listbox1_Callback(hObject, eventdata, handles)
% hObject    handle to listbox1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns listbox1 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from listbox1


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function listbox1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to listbox1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: listbox controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in apply.
function apply_Callback(hObject, eventdata, handles)
% Check if image exists
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first using the "Load Image" button.', 'No Image Found');
    return;
end

try
    % Initialize default kernel if not exists
    if ~isfield(handles, 'filterKernel')
        handles.filterKernel = ones(3,3)/9;
    end
    
    % Get selected filter type
    filterTypes = get(handles.popupmenu1, 'String');
    selectedFilter = filterTypes{get(handles.popupmenu1, 'Value')};
    
    % Get kernel data safely
    if isfield(handles, 'uitable3')
        kernelData = get(handles.uitable3, 'Data');
        if iscell(kernelData)
            % Convert cell to matrix, handling empty/non-numeric values
            kernelData = cellfun(@(x) ifelse(isempty(x)||~isnumeric(x),0,x), kernelData, 'UniformOutput', false);
            handles.filterKernel = cell2mat(kernelData);
        else
            handles.filterKernel = kernelData;
        end
    end
    
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Process image
    if size(img, 3) == 3
        img = rgb2gray(img);
    end
    
    % Apply selected filter
    switch selectedFilter
        case 'Correlation'
            filteredImg = imfilter(double(img), handles.filterKernel, 'corr', 'same');
        case 'Weighted'
            % Normalize kernel
            normalizedKernel = handles.filterKernel / sum(handles.filterKernel(:));
            filteredImg = imfilter(double(img), normalizedKernel, 'conv', 'same');
    end
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Show filtered result in axes2
    axes(handles.axes2);
    imshow(filteredImg, []);
    title([selectedFilter ' Result']);
    
    % Store for next operation
    handles.filteredImage = filteredImg;
    guidata(hObject, handles);
    
catch e
    errordlg(['Error applying filter: ' e.message], 'Filter Error');
end

% Helper function
function y = ifelse(condition, trueval, falseval)
if condition
    y = trueval;
else
    y = falseval;
end

% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function uitable3_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to uitable3 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASH- Executes when entered data in editable cell(s) in uitable3.
function uitable3_CellEditCallback(hObject, eventdata, handles)
% hObject    handle to uitable3 (see GCBO)
% eventdata  structure with the following fields (see MATLAB.UI.CONTROL.TABLE)
%	Indices: row and column indices of the cell(s) edited
%	PreviousData: previous data for the cell(s) edited
%	EditData: string(s) entered by the user
%	NewData: EditData or its converted form set on the Data property. Empty if Data was not changed
%	Error: error string when failed to convert EditData to appropriate value for Data
% handles    structure with handles and user data (see GUIDATA)
% Update the kernel when table values are edited
try
    newData = get(hObject, 'Data');
    % Convert from cell if needed
    if iscell(newData)
        newData = cell2mat(newData);
    end
    handles.filterKernel = newData;
    guidata(hObject, handles);
catch e
    errordlg(['Invalid kernel value: ' e.message], 'Input Error');
end


% REPLACE_WITH_DASH_DASH- Executes during object deletion, before destroying properties.
function uitable4_DeleteFcn(hObject, eventdata, handles)
% hObject    handle to uitable4 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function uitable4_CreateFcn(hObject, eventdata, handles)
% hObject    handle to uitable4 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called


% REPLACE_WITH_DASH_DASH- Executes during object deletion, before destroying properties.
function uipanel1_DeleteFcn(hObject, eventdata, handles)
% hObject    handle to uipanel1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASH- Executes on selection change in popupmenu3.
function popupmenu3_Callback(hObject, eventdata, handles)
% hObject    handle to popupmenu3 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu3 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from popupmenu3


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function popupmenu3_CreateFcn(hObject, eventdata, handles)
% hObject    handle to popupmenu3 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton3.
function pushbutton3_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton3 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton2.
function pushbutton2_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% Reset to default 3x3 averaging kernel
handles.filterKernel = ones(3,3)/9;
set(handles.uitable3, 'Data', handles.filterKernel);
guidata(hObject, handles);
msgbox('Kernel reset to default 3x3 averaging filter.', 'Reset Complete');


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton18 (Salt & Pepper Noise).
function pushbutton18_Callback(hObject, eventdata, handles)
    try
        % Get salt & pepper probabilities
        ps = str2double(get(handles.edit7, 'String'));
        pp = str2double(get(handles.edit8, 'String'));
        
        % Validate inputs
        if isnan(ps) || isnan(pp) || ps < 0 || pp < 0 || (ps+pp) > 1
            errordlg('Please enter valid probabilities (0 <= PS,PP <= 1, PS+PP <= 1)', 'Invalid Input');
            return;
        end
        
        % Check if image exists
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Please load an image first!', 'No Image');
            return;
        end
        
        % Use filtered image if it exists, otherwise use original
        if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        else
            img = handles.currentImage;
        end
        
        % Add salt & pepper noise
        noisy_img = imnoise(img, 'salt & pepper', ps+pp);
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show noisy result in axes2
        axes(handles.axes2);
        imshow(noisy_img);
        title(['Salt & Pepper Noise (PS=' num2str(ps) ', PP=' num2str(pp) ')']);
        
        % Store for next operation
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error adding salt & pepper noise: ' ME.message], 'Processing Error');
    end
% REPLACE_WITH_DASH_DASH- Executes on selection change in popupmenu6.
function popupmenu6_Callback(hObject, eventdata, handles)
% hObject    handle to popupmenu6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu6 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from popupmenu6


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function popupmenu6_CreateFcn(hObject, eventdata, handles)
% hObject    handle to popupmenu6 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton15.
function pushbutton15_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton15 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton8.
function pushbutton8_Callback(hObject, eventdata, handles)
% Check if images exist
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first.', 'No Image Found');
    return;
end

if ~isfield(handles, 'filteredImage') || isempty(handles.filteredImage)
    errordlg('No processed image available. Please apply a filter first.', 'No Processed Image');
    return;
end

try
    originalImg = handles.currentImage;
    filteredImg = handles.filteredImage;
    
    % Create figure for histogram comparison
    hFig = figure('Name', 'Histogram Comparison', 'NumberTitle', 'off', 'Position', [100 100 1000 800]);
    
    % Original image
    subplot(2,2,1);
    if size(originalImg, 3) == 3
        imshow(originalImg);
        title('Original Color Image');
        
        % RGB histograms
        subplot(2,2,3);
        imhist(originalImg(:,:,1));
        hold on;
        imhist(originalImg(:,:,2));
        imhist(originalImg(:,:,3));
        hold off;
        title('Original RGB Histograms');
        legend('Red','Green','Blue');
    else
        imshow(originalImg);
        title('Original Grayscale Image');
        
        subplot(2,2,3);
        imhist(originalImg);
        title('Original Histogram');
    end
    
    % Processed image
    subplot(2,2,2);
    imshow(filteredImg);
    title('Processed Image');
    
    subplot(2,2,4);
    if size(filteredImg, 3) == 3
        imhist(filteredImg(:,:,1));
        hold on;
        imhist(filteredImg(:,:,2));
        imhist(filteredImg(:,:,3));
        hold off;
        title('Processed RGB Histograms');
        legend('Red','Green','Blue');
    else
        imhist(filteredImg);
        title('Processed Histogram');
    end
    
    % Add main title
    annotation(hFig, 'textbox', [0.3 0.95 0.4 0.05], 'String', ...
        'Histogram Comparison: Original vs Processed Image', ...
        'EdgeColor', 'none', 'HorizontalAlignment', 'center', ...
        'FontSize', 12, 'FontWeight', 'bold');
    
catch e
    errordlg(['Error displaying histograms: ' e.message], 'Display Error');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton10.
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton10.
function pushbutton10_Callback(hObject, eventdata, handles)
% Check if image exists
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first.', 'No Image Found');
    return;
end

img = handles.currentImage;

try
    % Convert to grayscale if RGB
    if size(img, 3) == 3
        img = rgb2gray(img);
    end
    
    % Apply histogram equalization
    equalizedImg = histeq(img);
    
    % Display results
    axes(handles.axes2); % Assuming axes2 is for processed images
    imshow(equalizedImg);
    title('Histogram Equalization Result');
    
    % Show histograms comparison
    figure;
    subplot(2,1,1); imhist(img); title('Original Histogram');
    subplot(2,1,2); imhist(equalizedImg); title('Equalized Histogram');
    
    % Store the processed image
    handles.filteredImage = equalizedImg;
    guidata(hObject, handles);
    
catch e
    errordlg(['Error in histogram equalization: ' e.message], 'Processing Error');
end



function edit1_Callback(hObject, eventdata, handles)
% Validate new min value
val = str2double(get(hObject, 'String'));
if isnan(val) || val < 0 || val > 255
    set(hObject, 'String', '0');
    errordlg('Please enter a value between 0 and 255', 'Invalid Input');
end

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edit1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit2_Callback(hObject, eventdata, handles)
% Validate new max value
val = str2double(get(hObject, 'String'));
if isnan(val) || val < 0 || val > 255
    set(hObject, 'String', '255');
    errordlg('Please enter a value between 0 and 255', 'Invalid Input');
end

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edit2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton11.
function pushbutton11_Callback(hObject, eventdata, handles)
% Check if image exists
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first.', 'No Image Found');
    return;
end

% Get min and max values from edit boxes
try
    newMin = str2double(get(handles.edit1, 'String'));
    newMax = str2double(get(handles.edit2, 'String'));
    
    if isnan(newMin) || isnan(newMax) || newMin >= newMax
        errordlg('Please enter valid min/max values (min < max).', 'Invalid Input');
        return;
    end
    
    img = handles.currentImage;
    
    % Convert to grayscale if RGB
    if size(img, 3) == 3
        img = rgb2gray(img);
    end
    
    % Perform contrast stretching
    minVal = double(min(img(:)));
    maxVal = double(max(img(:)));
    
    stretchedImg = (double(img) - minVal) .* ((newMax - newMin)/(maxVal - minVal)) + newMin;
    stretchedImg = uint8(stretchedImg);
    
    % Display results
    axes(handles.axes2);
    imshow(stretchedImg);
    title(['Contrast Stretching [' num2str(newMin) ' to ' num2str(newMax) ']']);
    
    % Store the processed image
    handles.filteredImage = stretchedImg;
    guidata(hObject, handles);
    
catch e
    errordlg(['Error in contrast stretching: ' e.message], 'Processing Error');
end



% REPLACE_WITH_DASH_DASH- Edit box callbacks (validation)
function edit7_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 1, false); % Salt & Pepper PS (0-1)
% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit7_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit8_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 1, false); % Salt & Pepper PP (0-1)

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit8_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton19 (Uniform Noise).
function pushbutton19_Callback(hObject, eventdata, handles)
    try
        % Get parameters
        a = str2double(get(handles.edit9, 'String'));
        b = str2double(get(handles.edit10, 'String'));
        P = str2double(get(handles.edit11, 'String'))/100;
        
        % Validate
        if isnan(a) || isnan(b) || isnan(P) || b <= a || P <= 0 || P > 1
            errordlg('Invalid parameters (a < b, 0 < P <= 100)', 'Error');
            return;
        end
        
        % Check image
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Load image first!', 'Error');
            return;
        end
        
        % Use filtered image if it exists, otherwise use original
        if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        else
            img = handles.currentImage;
        end
        
        [rows, cols, ch] = size(img);
        
        % Generate and scale noise properly
        noise = a + (b-a)*rand(rows, cols, ch);
        noisy_img = double(img) + P*noise;
        
        % Ensure proper range
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show noisy result in axes2
        axes(handles.axes2);
        imshow(noisy_img);
        title('Uniform Noise Added');
        
        % Store for next operation
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error: ' ME.message], 'Error');
    end
function edit9_Callback(hObject, eventdata, handles)
validateInput(hObject, -255, 255, true); % Uniform a

function edit9_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit10_Callback(hObject, eventdata, handles)
validateInput(hObject, -255, 255, true); % Uniform b

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit10_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


function edit11_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); % Uniform P (0-100%)

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit11_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton20 (Gaussian Noise).
function pushbutton20_Callback(hObject, eventdata, handles)
    try
        seg = str2double(get(handles.edit12, 'String'));
        m = str2double(get(handles.edit13, 'String'));
        P = str2double(get(handles.edit14, 'String'))/100;
        
        if isnan(seg) || isnan(m) || isnan(P) || seg <= 0 || P <= 0 || P > 1
            errordlg('Invalid parameters (seg > 0, 0 < P <= 100)', 'Error');
            return;
        end
        
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Load image first!', 'Error');
            return;
        end
        
        % Use filtered image if it exists, otherwise use original
        if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        else
            img = handles.currentImage;
        end
        
        [rows, cols, ch] = size(img);
        
        % Generate Gaussian noise
        noise = m + seg*randn(rows, cols, ch);
        noisy_img = double(img) + P*noise;
        
        % Clip and convert
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show noisy result in axes2
        axes(handles.axes2);
        imshow(noisy_img);
        title('Gaussian Noise Added');
        
        % Store for next operation
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error: ' ME.message], 'Error');
    end

function edit12_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); % Gaussian seg

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit12_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit13_Callback(hObject, eventdata, handles)
validateInput(hObject, -255, 255, true); % Gaussian m

function edit13_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit14_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); % Gaussian P (0-100%)
function edit14_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton21 (Rayleigh Noise).
function pushbutton21_Callback(hObject, eventdata, handles)
    try
        a = str2double(get(handles.edit20, 'String'));
        b = str2double(get(handles.edit19, 'String'));
        
        if isnan(a) || isnan(b) || b <= 0
            errordlg('Invalid parameters (b > 0)', 'Error');
            return;
        end
        
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Load image first!', 'Error');
            return;
        end
        
        % Use filtered image if it exists, otherwise use original
        if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        else
            img = handles.currentImage;
        end
        
        [rows, cols, ch] = size(img);
        
        % Generate Rayleigh noise
        noise = a + (-b*log(1 - rand(rows, cols, ch))).^0.5;
        noisy_img = double(img) + noise;
        
        % Normalize to 0-255 range
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show noisy result in axes2
        axes(handles.axes2);
        imshow(noisy_img);
        title('Rayleigh Noise Added');
        
        % Store for next operation
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error: ' ME.message], 'Error');
    end

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton22 (Exponential Noise).
function pushbutton22_Callback(hObject, eventdata, handles)
    try
        a = str2double(get(handles.edit17, 'String'));
        b = str2double(get(handles.edit18, 'String'));
        
        if isnan(a) || isnan(b) || a <= 0
            errordlg('Invalid parameters (a > 0)', 'Error');
            return;
        end
        
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Load image first!', 'Error');
            return;
        end
        
        % Use filtered image if it exists, otherwise use original
        if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        else
            img = handles.currentImage;
        end
        
        [rows, cols, ch] = size(img);
        
        % Generate Exponential noise
        noise = (-1/a)*log(1 - rand(rows, cols, ch));
        noisy_img = double(img) + b*noise;
        
        % Normalize
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show noisy result in axes2
        axes(handles.axes2);
        imshow(noisy_img);
        title('Exponential Noise Added');
        
        % Store for next operation
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error: ' ME.message], 'Error');
    end
function edit17_Callback(hObject, eventdata, handles)
validateInput(hObject, 0.01, 100, false); % Exponential a

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit17_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit18_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 255, true); % Exponential b

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit18_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit19_Callback(hObject, eventdata, handles)
validateInput(hObject, 0.01, 255, false); % Rayleigh b
% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit19_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit20_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 255, true); % Rayleigh a
% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit20_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton24 (Gamma Noise).
function pushbutton24_Callback(hObject, eventdata, handles)
    try
        a = str2double(get(handles.edit21, 'String'));
        b = str2double(get(handles.edit22, 'String'));
        
        if isnan(a) || isnan(b) || a <= 0 || b <= 0
            errordlg('Invalid parameters (a > 0, b > 0)', 'Error');
            return;
        end
        
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Load image first!', 'Error');
            return;
        end
        
        % Use filtered image if it exists, otherwise use original
        if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
            img = handles.filteredImage;
        else
            img = handles.currentImage;
        end
        
        [rows, cols, ch] = size(img);
        
        % Generate Gamma noise
        if exist('gamrnd', 'file')
            noise = gamrnd(a, b, rows, cols, ch);
        else
            noise = zeros(rows, cols, ch);
            for k = 1:a
                noise = noise - b*log(1 - rand(rows, cols, ch));
            end
        end
        
        noisy_img = double(img) + noise;
        
        % Normalize
        noisy_img = max(0, min(255, noisy_img));
        noisy_img = uint8(noisy_img);
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show noisy result in axes2
        axes(handles.axes2);
        imshow(noisy_img);
        title('Gamma Noise Added');
        
        % Store for next operation
        handles.filteredImage = noisy_img;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error: ' ME.message], 'Error');
    end
% REPLACE_WITH_DASH_DASH- Executes on selection change in popupmenu7.
function popupmenu7_Callback(hObject, eventdata, handles)
    % No special handling needed here - we'll use the selection in the apply button
    guidata(hObject, handles);
function popupmenu7_CreateFcn(hObject, eventdata, handles)
    if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
        set(hObject,'BackgroundColor','white');
    end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton25.
function pushbutton25_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton25 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)



function edit21_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 100, false); % Gamma a

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit21_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function edit22_Callback(hObject, eventdata, handles)
validateInput(hObject, 0, 255, true); % Gamma b

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit22_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton56.
function pushbutton56_Callback(hObject, eventdata, handles)
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    % Get threshold value
    threshold = str2double(get(handles.edit29, 'String'));
    if isnan(threshold) || threshold < 0 || threshold > 255
        errordlg('Threshold must be between 0-255!', 'Invalid Threshold');
        return;
    end
    
    % Convert to grayscale first if color image
    if size(handles.currentImage, 3) == 3
        grayImg = rgb2gray(handles.currentImage);
    else
        grayImg = handles.currentImage;
    end
    
    % Convert to binary
    handles.processedImage = imbinarize(grayImg, threshold/255);
    
    % Display result
    axes(handles.axes2);
    imshow(handles.processedImage);
    title(['Binary Image (Threshold: ' num2str(threshold) ')']);
    
    guidata(hObject, handles);
catch ME
    errordlg(['Error in binary conversion: ' ME.message], 'Processing Error');
end
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton58.
function pushbutton58_Callback(hObject, eventdata, handles)
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    % Get conversion method
    method = round(str2double(get(handles.edit30, 'String')));
    if isnan(method) || method < 1 || method > 5
        errordlg('Method must be 1-5!', 'Invalid Method');
        return;
    end
    
    % Apply selected grayscale conversion
    if size(handles.currentImage, 3) == 3
        switch method
            case 1 % Gray by Division (average)
                grayImg = mean(handles.currentImage, 3);
            case 2 % Gray by Percentage (weighted)
                weights = [0.2989, 0.5870, 0.1140]; % Standard luminance weights
                grayImg = handles.currentImage(:,:,1)*weights(1) + ...
                         handles.currentImage(:,:,2)*weights(2) + ...
                         handles.currentImage(:,:,3)*weights(3);
            case 3 % Red channel
                grayImg = handles.currentImage(:,:,1);
            case 4 % Green channel
                grayImg = handles.currentImage(:,:,2);
            case 5 % Blue channel
                grayImg = handles.currentImage(:,:,3);
        end
        handles.processedImage = uint8(grayImg);
    else
        handles.processedImage = handles.currentImage; % Already grayscale
    end
    
    % Display result
    axes(handles.axes2);
    imshow(handles.processedImage);
    
    % Set appropriate title
    methodNames = {'Average', 'Luminance', 'Red Channel', 'Green Channel', 'Blue Channel'};
    title(['Grayscale (' methodNames{method} ')']);
    
    guidata(hObject, handles);
catch ME
    errordlg(['Error in grayscale conversion: ' ME.message], 'Processing Error');
end


function edit29_Callback(hObject, eventdata, handles)
% Validate binary threshold input
val = str2double(get(hObject, 'String'));
if isnan(val) || val < 0 || val > 255
    errordlg('Threshold must be 0-255!', 'Invalid Input');
    set(hObject, 'String', '127'); % Reset to default
end

function edit29_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end
set(hObject, 'String', '127'); % Default threshold

function edit30_Callback(hObject, eventdata, handles)
% Validate grayscale method input
val = round(str2double(get(hObject, 'String')));
if isnan(val) || val < 1 || val > 5
    errordlg('Method must be 1-5!', 'Invalid Input');
    set(hObject, 'String', '1'); % Reset to default
end

function edit30_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end
set(hObject, 'String', '1'); % Default method


function pushbutton52_Callback(hObject, eventdata, handles)
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    value = str2double(get(handles.edit28, 'String'));
    if isnan(value)
        errordlg('Please enter a valid number!', 'Invalid Input');
        return;
    end
    
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Add value to each pixel (clamping to 255)
    adjusted = double(img) + value;
    handles.filteredImage = uint8(min(adjusted, 255));
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Display result
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title(['Brightness Increased (Add ' num2str(value) ')']);
    
    guidata(hObject, handles);
catch ME
    errordlg(['Error: ' ME.message], 'Processing Error');
end

function pushbutton53_Callback(hObject, eventdata, handles)
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    value = str2double(get(handles.edit28, 'String'));
    if isnan(value) || value <= 0
        errordlg('Please enter a positive number!', 'Invalid Input');
        return;
    end
    
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Multiply each pixel (clamping to 255)
    adjusted = double(img) * value;
    handles.filteredImage = uint8(min(adjusted, 255));
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Display result
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title(['Brightness Increased (Multiply by ' num2str(value) ')']);
    
    guidata(hObject, handles);
catch ME
    errordlg(['Error: ' ME.message], 'Processing Error');
end

function pushbutton54_Callback(hObject, eventdata, handles)
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    value = str2double(get(handles.edit28, 'String'));
    if isnan(value)
        errordlg('Please enter a valid number!', 'Invalid Input');
        return;
    end
    
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Subtract value from each pixel (clamping to 0)
    adjusted = double(img) - value;
    handles.filteredImage = uint8(max(adjusted, 0));
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Display result
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title(['Brightness Decreased (Subtract ' num2str(value) ')']);
    
    guidata(hObject, handles);
catch ME
    errordlg(['Error: ' ME.message], 'Processing Error');
end

function pushbutton55_Callback(hObject, eventdata, handles)
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    value = str2double(get(handles.edit28, 'String'));
    if isnan(value) || value <= 0
        errordlg('Please enter a positive number!', 'Invalid Input');
        return;
    end
    
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Divide each pixel (clamping to 0)
    adjusted = double(img) / value;
    handles.filteredImage = uint8(max(adjusted, 0));
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Display result
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title(['Brightness Decreased (Divide by ' num2str(value) ')']);
    
    guidata(hObject, handles);
catch ME
    errordlg(['Error: ' ME.message], 'Processing Error');
end

function edit28_Callback(hObject, eventdata, handles)
% Validate input
value = str2double(get(hObject, 'String'));
if isnan(value)
    errordlg('Please enter a valid number!', 'Invalid Input');
    set(hObject, 'String', '10'); % Reset to default
end
handles.brightnessValue = value;
guidata(hObject, handles);

function edit28_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end
set(hObject, 'String', '10'); % Default value


function edit26_Callback(hObject, eventdata, handles)
% D0 cutoff frequency - no action needed

function edit26_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end
set(hObject, 'String', '5'); % Default D0 value

function edit27_Callback(hObject, eventdata, handles)
% Butterworth order - no action needed

function edit27_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end
set(hObject, 'String', '1'); % Default Butterworth order


% REPLACE_WITH_DASH_DASH- Executes on selection change in popupmenu10.
function popupmenu10_Callback(hObject, eventdata, handles)
% hObject    handle to popupmenu10 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns popupmenu10 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from popupmenu10


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function popupmenu10_CreateFcn(hObject, eventdata, handles)
% hObject    handle to popupmenu10 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

% Helper function for Ideal Filter
function output = idealFilter(img, D0, type)
    [M, N] = size(img);
    [u, v] = meshgrid(1:N, 1:M);
    D = sqrt((u - N/2).^2 + (v - M/2).^2);
    
    if strcmpi(type, 'low')
        H = double(D <= D0);
    else % high pass
        H = double(D > D0);
    end
    
    output = applyFrequencyFilter(img, H);

% Helper function for Butterworth Filter
function output = butterworthFilter(img, D0, n, type)
    [M, N] = size(img);
    [u, v] = meshgrid(1:N, 1:M);
    D = sqrt((u - N/2).^2 + (v - M/2).^2);
    
    if strcmpi(type, 'low')
        H = 1 ./ (1 + (D./D0).^(2*n));
    else % high pass
        H = 1 ./ (1 + (D0./D).^(2*n));
    end
    
    output = applyFrequencyFilter(img, H);

% Helper function for Gaussian Filter
function output = gaussianFilter(img, D0, type)
    [M, N] = size(img);
    [u, v] = meshgrid(1:N, 1:M);
    D = sqrt((u - N/2).^2 + (v - M/2).^2);
    
    if strcmpi(type, 'low')
        H = exp(-(D.^2)./(2*D0^2));
    else % high pass
        H = 1 - exp(-(D.^2)./(2*D0^2));
    end
    
    output = applyFrequencyFilter(img, H);
% Common frequency filter application
function output = applyFrequencyFilter(img, H)
    % Convert to double
    img = im2double(img);
    
    % Compute DFT
    F = fftshift(fft2(img));
    
    % Apply filter
    G = H .* F;
    
    % Inverse DFT
    output = real(ifft2(ifftshift(G)));
    
    % Normalize to 0-1 range
    output = mat2gray(output);
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton50 (Apply Frequency Filter).
function pushbutton50_Callback(hObject, eventdata, handles)
% Check if image exists
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    % Get parameters from GUI
    D0 = str2double(get(handles.edit26, 'String'));
    n = str2double(get(handles.edit27, 'String')); % For Butterworth
    filterTypes = get(handles.popupmenu10, 'String');
    filterType = get(handles.popupmenu10, 'Value');
    selectedFilterName = filterTypes{filterType}; % Get the name of selected filter
    
    % Validate parameters
    if isnan(D0) || D0 <= 0
        errordlg('Please enter a valid positive D0 value!', 'Invalid Parameter');
        return;
    end
    
    if (filterType == 3 || filterType == 4) && (isnan(n) || n <= 0)
        errordlg('Please enter a valid positive Butterworth order!', 'Invalid Parameter');
        return;
    end
    
    % Convert to grayscale if color image
    if size(handles.currentImage, 3) == 3
        img = rgb2gray(handles.currentImage);
    else
        img = handles.currentImage;
    end
    
    % Apply selected frequency domain filter
    switch filterType
        case 1 % Ideal Low Pass
            filtered = idealFilter(img, D0, 'low');
        case 2 % Ideal High Pass
            filtered = idealFilter(img, D0, 'high');
        case 3 % Butterworth Low Pass
            filtered = butterworthFilter(img, D0, n, 'low');
        case 4 % Butterworth High Pass
            filtered = butterworthFilter(img, D0, n, 'high');
        case 5 % Gaussian Low Pass
            filtered = gaussianFilter(img, D0, 'low');
        case 6 % Gaussian High Pass
            filtered = gaussianFilter(img, D0, 'high');
    end
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Show result in axes2
    axes(handles.axes2);
    imshow(filtered);
    title([selectedFilterName ' Filter']);
    
    % Store for next operation
    handles.filteredImage = filtered;
    guidata(hObject, handles);
    
catch ME
    errordlg(['Error in frequency filtering: ' ME.message], 'Processing Error');
end
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton45 (Fourier Transform).
function pushbutton45_Callback(hObject, eventdata, handles)
% Check if image is loaded
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image');
    return;
end

try
    % Convert to grayscale if color image
    if size(handles.currentImage, 3) == 3
        img = rgb2gray(handles.currentImage);
    else
        img = handles.currentImage;
    end
    
    % Compute Fourier Transform
    f_img = fft2(double(img));
    fshift = fftshift(f_img);
    magnitude_spectrum = mat2gray(log(1 + abs(fshift)));
    
    % Store Fourier data
    handles.fourierData = fshift;
    
    % Display magnitude spectrum
    axes(handles.axes2);
    imshow(magnitude_spectrum, []);
    colormap(handles.axes2, gray); % Use colormap for better visualization
    colorbar(handles.axes2);
    title('Fourier Transform (Magnitude Spectrum)');
    
    % Update handles
    guidata(hObject, handles);
    
catch ME
    errordlg(['Error in Fourier Transform: ' ME.message], 'Processing Error');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton46 (Inverse Fourier Transform).
function pushbutton46_Callback(hObject, eventdata, handles)
% Check if Fourier data exists
if ~isfield(handles, 'fourierData') || isempty(handles.fourierData)
    errordlg('Please perform Fourier Transform first!', 'No Fourier Data');
    return;
end

try
    % Compute Inverse Fourier Transform
    f_ishift = ifftshift(handles.fourierData);
    img_back = ifft2(f_ishift);
    
    % Display reconstructed image
    axes(handles.axes2);
    imshow(img_back, []);
    title('Inverse Fourier Transform (Reconstructed Image)');
    colorbar(handles.axes2, 'off'); % Remove colorbar for spatial domain
    
    % Store reconstructed image
    handles.reconstructedImage = img_back;
    
    % Update handles
    guidata(hObject, handles);
    
catch ME
    errordlg(['Error in Inverse Fourier Transform: ' ME.message], 'Processing Error');
end


function edit24_Callback(hObject, eventdata, handles)
% hObject    handle to edit24 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of edit24 as text
%        str2double(get(hObject,'String')) returns contents of edit24 as a double


% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit24_CreateFcn(hObject, eventdata, handles)
% hObject    handle to edit24 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton42.
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton42.
function pushbutton42_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton42 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

[filename, pathname] = uigetfile({'*.jpg;*.png;*.bmp;*.tif;*.tiff', 'Image Files'}, 'Select an Image');
if isequal(filename, 0)
    return; % User cancelled
end

try
    % Read and store the image
    img = imread(fullfile(pathname, filename));
    handles.currentImage = img;
    
    % Display the original image
    axes(handles.axes1); % Make sure you have an axes component named axes1
    imshow(img);
    title('Original Image');
    
    % Update handles structure
    guidata(hObject, handles);
catch e
    errordlg(['Error loading image: ' e.message], 'Image Load Error');
end
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton43.
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton43.
function pushbutton43_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton43 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Check if there's a filtered image to save
if ~isfield(handles, 'filteredImage') || isempty(handles.filteredImage)
    errordlg('No filtered image available to save. Please apply a filter first.', 'Nothing to Save');
    return;
end

% Get the filtered image
filteredImg = handles.filteredImage;

% Prepare default filename with timestamp
defaultName = ['filtered_' datestr(now, 'yyyymmdd_HHMMSS') '.png'];

% Ask user for save location
[filename, pathname] = uiputfile(...
    {'*.png','PNG files (*.png)'; ...
     '*.jpg','JPEG files (*.jpg)'; ...
     '*.tif','TIFF files (*.tif)'; ...
     '*.*','All Files (*.*)'}, ...
    'Save Filtered Image As', ...
    defaultName);

if isequal(filename, 0) || isequal(pathname, 0)
    return; % User cancelled
end

try
    % Save the image with appropriate format
    [~, ~, ext] = fileparts(filename);
    switch lower(ext)
        case '.png'
            imwrite(filteredImg, fullfile(pathname, filename), 'png');
        case '.jpg'
            imwrite(filteredImg, fullfile(pathname, filename), 'jpg', 'Quality', 90);
        case '.tif'
            imwrite(filteredImg, fullfile(pathname, filename), 'tif');
        otherwise
            % Default to PNG if extension not recognized
            imwrite(filteredImg, fullfile(pathname, [filename '.png']), 'png');
    end
    
    % Notify user of successful save
    msgbox(['Image successfully saved to: ' fullfile(pathname, filename)], 'Save Complete');
    
catch e
    errordlg(['Error saving image: ' e.message], 'Save Error');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton37 (Negative).
function pushbutton37_Callback(hObject, eventdata, handles)
% Check if image exists and is loaded
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image Loaded');
    return;
end

try
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Apply negative transformation
    negative = 255 - img;
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Show result in axes2
    axes(handles.axes2);
    imshow(negative);
    title('Negative Transform');
    
    % Store for next operation
    handles.filteredImage = negative;
    guidata(hObject, handles);
    
catch ME
    errordlg(['Error in negative transformation: ' ME.message], 'Processing Error');
end
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton40 (Log).
function pushbutton40_Callback(hObject, eventdata, handles)
% Check if image exists and is loaded
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image Loaded');
    return;
end

try
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Convert image to double and normalize
    img = im2double(img);
    
    % Apply log transformation
    c = 1/log(1 + max(img(:))); % Scaling constant
    logImg = c * log(1 + img);
    
    % Convert back to uint8
    transformed = im2uint8(logImg);
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Show result in axes2
    axes(handles.axes2);
    imshow(transformed);
    title('Log Transform');
    
    % Store for next operation
    handles.filteredImage = transformed;
    guidata(hObject, handles);
    
catch ME
    errordlg(['Error in log transformation: ' ME.message], 'Processing Error');
end
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton41 (Gamma).
function pushbutton41_Callback(hObject, eventdata, handles)
% Check if image exists and is loaded
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first!', 'No Image Loaded');
    return;
end

try
    % Get gamma value from edit box
    gammaStr = get(handles.edit23, 'String');
    gamma = str2double(gammaStr);
    
    % Validate gamma value
    if isnan(gamma) || gamma <= 0
        errordlg('Gamma must be a positive number!', 'Invalid Gamma Value');
        set(handles.edit23, 'String', '1.0'); % Reset to default
        return;
    end
    
    % Apply gamma transformation
    img = im2double(handles.currentImage);
    gammaImg = img.^gamma;
    handles.filteredImage = im2uint8(gammaImg);
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title(['Gamma Correction (\gamma = ' num2str(gamma) ')']);
    
    % Show result in axes2
    axes(handles.axes2);
    imshow(handles.filteredImage);
    title(['Gamma Correction (\gamma = ' num2str(gamma) ')']);
    
    % Store for next operation
    handles.filteredImage = handles.filteredImage;
    guidata(hObject, handles);
    
catch ME
    errordlg(['Error in gamma transformation: ' ME.message], 'Processing Error');
end



function edit23_Callback(hObject, eventdata, handles)
% Get current gamma value
gammaStr = get(hObject, 'String');
gamma = str2double(gammaStr);

% Validate input
if isnan(gamma) || gamma <= 0
    errordlg('Gamma must be a positive number!', 'Invalid Input');
    set(hObject, 'String', '1.0'); % Reset to default
    return;
end

% If image is loaded, show preview
if isfield(handles, 'currentImage') && ~isempty(handles.currentImage)
    try
        % Create preview on a small version of the image
        smallImg = imresize(handles.currentImage, 0.2); % Reduce size for faster preview
        previewImg = im2uint8(im2double(smallImg).^gamma);
        
        % Display preview
        axes(handles.axes2);
        imshow(previewImg);
        title(['Gamma Preview (\gamma=' gammaStr ')']);
    catch
        % Fail silently for preview errors
    end
end

% REPLACE_WITH_DASH_DASH- Executes during object creation, after setting all properties.
function edit23_CreateFcn(hObject, eventdata, handles)
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end
set(hObject, 'String', '1.0'); % Default gamma value
function applyLineOperation(handles, direction)
    try
        % Check if image exists
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Please load an image first!', 'No Image');
            return;
        end
        
        % Get selected operation
        operations = get(handles.popupmenu8, 'String');
        selectedOp = operations{get(handles.popupmenu8, 'Value')};
        
        % Convert to grayscale if needed
        if size(handles.currentImage, 3) == 3
            img = rgb2gray(handles.currentImage);
        else
            img = handles.currentImage;
        end
        
        % Convert to double for processing
        img = double(img);
        
        % Apply the selected operation
        switch selectedOp
            case 'Line Detection (Sobel)'
                switch direction
                    case 'H'
                        kernel = [-1 -2 -1; 0 0 0; 1 2 1]; % Horizontal Sobel
                    case 'V'
                        kernel = [-1 0 1; -2 0 2; -1 0 1]; % Vertical Sobel
                    case 'DL'
                        kernel = [0 1 2; -1 0 1; -2 -1 0]; % Diagonal Left Sobel
                    case 'DR'
                        kernel = [-2 -1 0; -1 0 1; 0 1 2]; % Diagonal Right Sobel
                end
                result = imfilter(img, kernel);
                
            case 'Line Detection (Roberts)'
                switch direction
                    case 'H'
                        kernel = [1 0; 0 -1]; % Horizontal Roberts
                    case 'V'
                        kernel = [0 1; -1 0]; % Vertical Roberts
                    case 'DL'
                        kernel = [0 -1; 1 0]; % Diagonal Left Roberts
                    case 'DR'
                        kernel = [-1 0; 0 1]; % Diagonal Right Roberts
                end
                result = imfilter(img, kernel);
                
            case 'Line Sharpening'
                switch direction
                    case 'H'
                        kernel = [0 -1 0; 0 3 0; 0 -1 0]; % Horizontal sharpening
                    case 'V'
                        kernel = [0 0 0; -1 3 -1; 0 0 0]; % Vertical sharpening
                    case 'DL'
                        kernel = [-1 0 0; 0 3 0; 0 0 -1]; % Diagonal Left sharpening
                    case 'DR'
                        kernel = [0 0 -1; 0 3 0; -1 0 0]; % Diagonal Right sharpening
                end
                result = imfilter(img, kernel);
        end
        
        % Normalize and convert to uint8
        result = mat2gray(result); % Normalize to [0,1]
        result = im2uint8(result); % Convert to uint8
        
        % Display results
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        axes(handles.axes2);
        imshow(result);
        title([selectedOp ' (' direction ' Direction)']);
        
        % Store result
        handles.filteredImage = result;
        guidata(handles.figure1, handles);
        
    catch ME
        errordlg(['Error in ' selectedOp ': ' ME.message], 'Processing Error');
    end

% REPLACE_WITH_DASH_DASH- Executes on selection change in popupmenu8 line detect and sharpening
function popupmenu8_Callback(hObject, eventdata, handles)
    % Keep buttons visible for all operations
    set([handles.pushbutton31, handles.pushbutton32, handles.pushbutton33, handles.pushbutton34], 'Visible', 'on');
    guidata(hObject, handles);

function popupmenu8_CreateFcn(hObject, eventdata, handles)
    if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
        set(hObject,'BackgroundColor','white');
    end




% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton27.
function pushbutton27_Callback(hObject, eventdata, handles)
    try
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Please load an image first!', 'No Image');
            return;
        end
        
        % Get selected operation
        operations = get(handles.popupmenu8, 'String');
        selectedOp = operations{get(handles.popupmenu8, 'Value')};
        
        % Convert to grayscale if needed
        if size(handles.currentImage, 3) == 3
            img = rgb2gray(handles.currentImage);
        else
            img = handles.currentImage;
        end
        
        % Apply selected operation
        switch selectedOp
            case 'Line Detection (Sobel)'
                % Default to horizontal for Sobel
                result = edge(img, 'sobel', 'horizontal');
                
            case 'Line Detection (Roberts)'
                % Default to horizontal for Roberts
                result = edge(img, 'roberts', 'horizontal');
                
            case 'Line Sharpening'
                % Unsharp masking for line sharpening
                blurred = imgaussfilt(img, 1);
                mask = img - blurred;
                result = img + 1.5*mask; % Increased sharpening factor
                result = uint8(min(max(result, 0), 255));
        end
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show result in axes2
        axes(handles.axes2);
        imshow(result);
        title([selectedOp ' Result']);
        
        % Store result
        handles.filteredImage = result;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error in ' selectedOp ': ' ME.message], 'Processing Error');
    end

% REPLACE_WITH_DASH_DASH- Direction buttons callbacks
function pushbutton31_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, 'H');

function pushbutton32_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, 'V');

function pushbutton33_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, 'DL');

function pushbutton34_Callback(hObject, eventdata, handles)
    applyLineOperation(handles, 'DR');

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton28 (Apply Point Operation)
function pushbutton28_Callback(hObject, eventdata, handles)
    try
        % Check if image exists
        if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
            errordlg('Please load an image first!', 'No Image');
            return;
        end
        
        % Get selected operation
        operations = get(handles.popupmenu7, 'String');
        selectedOp = operations{get(handles.popupmenu7, 'Value')};
        
        % Convert to grayscale if color image
        if size(handles.currentImage, 3) == 3
            img = rgb2gray(handles.currentImage);
        else
            img = handles.currentImage;
        end
        
        % Apply selected operation
        switch selectedOp
            case 'Point Detection'
                % Laplacian for point detection
                h = [1 1 1; 1 -8 1; 1 1 1]; % Laplacian kernel
                filtered = imfilter(double(img), h, 'same');
                result = abs(filtered); % Get absolute values
                result = uint8(255 * mat2gray(result)); % Normalize to 0-255
                
            case 'Point Sharpening'
                % Unsharp masking for sharpening
                blurred = imgaussfilt(img, 2);
                mask = img - blurred;
                result = img + mask; % Add the mask back to original
                result = uint8(min(max(result, 0), 255)); % Clamp to 0-255
        end
        
        % Always show original in axes1
        axes(handles.axes1);
        imshow(handles.currentImage);
        title('Original Image');
        
        % Show result in axes2
        axes(handles.axes2);
        imshow(result);
        title(selectedOp);
        
        % Store result
        handles.filteredImage = result;
        guidata(hObject, handles);
        
    catch ME
        errordlg(['Error in ' selectedOp ': ' ME.message], 'Processing Error');
    end
% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton29.
function pushbutton29_Callback(hObject, eventdata, handles)
% Check if image exists
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first.', 'No Image Found');
    return;
end

% Get selected filter
filterList = get(handles.popupmenu6, 'String');
selectedFilter = filterList{get(handles.popupmenu6, 'Value')};

try
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    originalImg = img; % Keep copy of original for histogram
    
    % Convert to grayscale if RGB (most noise filters work on grayscale)
    if size(img, 3) == 3
        img = rgb2gray(img);
        isRGB = true;
    else
        isRGB = false;
    end
    
    % Apply selected filter
    switch selectedFilter
        case 'Min Filter'
            filteredImg = ordfilt2(img, 1, ones(handles.kernelSize));
        case 'Max Filter'
            filteredImg = ordfilt2(img, handles.kernelSize^2, ones(handles.kernelSize));
        case 'Mean Filter'
            h = fspecial('average', handles.kernelSize);
            filteredImg = imfilter(img, h);
        case 'Median Filter'
            filteredImg = medfilt2(img, [handles.kernelSize handles.kernelSize]);
        case 'Midpoint Filter'
            minImg = ordfilt2(img, 1, ones(handles.kernelSize));
            maxImg = ordfilt2(img, handles.kernelSize^2, ones(handles.kernelSize));
            filteredImg = (double(minImg) + double(maxImg)) / 2;
            filteredImg = uint8(filteredImg);
    end
    
    % Convert back to RGB if original was RGB
    if isRGB
        filteredImg = cat(3, filteredImg, filteredImg, filteredImg);
    end
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Show filtered result in axes2
    axes(handles.axes2);
    imshow(filteredImg);
    title([selectedFilter ' Result']);
    
    % Store for next operation
    handles.filteredImage = filteredImg;
    guidata(hObject, handles);
    
    % Create figure for histogram comparison
    hFig = figure('Name', 'Histogram Comparison', 'NumberTitle', 'off', 'Position', [100 100 1000 800]);
    
    % Original image
    subplot(2,2,1);
    if size(originalImg, 3) == 3
        imshow(originalImg);
        title('Original Color Image');
        
        % RGB histograms
        subplot(2,2,3);
        imhist(originalImg(:,:,1));
        hold on;
        imhist(originalImg(:,:,2));
        imhist(originalImg(:,:,3));
        hold off;
        title('Original RGB Histograms');
        legend('Red','Green','Blue');
    else
        imshow(originalImg);
        title('Original Grayscale Image');
        
        subplot(2,2,3);
        imhist(originalImg);
        title('Original Histogram');
    end
    
    % Processed image
    subplot(2,2,2);
    imshow(filteredImg);
    title([selectedFilter ' Result']);
    
    subplot(2,2,4);
    if isRGB
        imhist(filteredImg(:,:,1));
        hold on;
        imhist(filteredImg(:,:,2));
        imhist(filteredImg(:,:,3));
        hold off;
        title('Processed RGB Histograms');
        legend('Red','Green','Blue');
    else
        imhist(filteredImg);
        title('Processed Histogram');
    end
    
    % Add main title (alternative to sgtitle for older MATLAB versions)
    annotation(hFig, 'textbox', [0.3 0.95 0.4 0.05], 'String', ...
        ['Histogram Comparison: ' selectedFilter ' (Kernel: ' num2str(handles.kernelSize) 'x' num2str(handles.kernelSize) ')'], ...
        'EdgeColor', 'none', 'HorizontalAlignment', 'center', ...
        'FontSize', 12, 'FontWeight', 'bold');
    
catch e
    errordlg(['Error applying ' selectedFilter ': ' e.message], 'Filter Error');
end

% REPLACE_WITH_DASH_DASH- Executes on button press in pushbutton30.
function pushbutton30_Callback(hObject, eventdata, handles)
% Check if image exists
if ~isfield(handles, 'currentImage') || isempty(handles.currentImage)
    errordlg('Please load an image first.', 'No Image Found');
    return;
end

% Get selected filter
filterList = get(handles.popupmenu3, 'String');
selectedFilter = filterList{get(handles.popupmenu3, 'Value')};

try
    % Use filtered image if it exists, otherwise use original
    if isfield(handles, 'filteredImage') && ~isempty(handles.filteredImage)
        img = handles.filteredImage;
    else
        img = handles.currentImage;
    end
    
    % Convert to grayscale if RGB
    if size(img, 3) == 3
        img = rgb2gray(img);
    end
    
    % Apply selected filter
    switch selectedFilter
        case 'Min Filter'
            filteredImg = ordfilt2(img, 1, ones(3,3));
            
        case 'Max Filter'
            filteredImg = ordfilt2(img, 9, ones(3,3));
            
        case 'Mean Filter'
            h = fspecial('average', 3);
            filteredImg = imfilter(img, h);
            
        case 'Midpoint Filter'
            minImg = ordfilt2(img, 1, ones(3,3));
            maxImg = ordfilt2(img, 9, ones(3,3));
            filteredImg = (double(minImg) + double(maxImg)) / 2;
            filteredImg = uint8(filteredImg);
            
        case 'Median Filter'
            filteredImg = medfilt2(img, [3 3]);
            
    end
    
    % Always show original in axes1
    axes(handles.axes1);
    imshow(handles.currentImage);
    title('Original Image');
    
    % Show filtered result in axes2
    axes(handles.axes2);
    imshow(filteredImg);
    title([selectedFilter ' Result']);
    
    % Store for next operation
    handles.filteredImage = filteredImg;
    guidata(hObject, handles);
    
catch e
    errordlg(['Error applying ' selectedFilter ': ' e.message], 'Filter Error');
end

##### SOURCE END #####
--></body></html>